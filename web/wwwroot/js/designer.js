!function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=14)}([function(t,e,s){"use strict";s.d(e,"a",(function(){return i})),s.d(e,"c",(function(){return n})),s.d(e,"b",(function(){return a}));let i={remove:function(t,e){let s=!1;if(e&&e instanceof Array)for(let i=0,n=e.length;i<n;i++)e[i]===t&&(e.splice(i,1),s=!0);return s}},n={forEachOwnProperty:function(t,e){for(let s in t)t.hasOwnProperty(s)&&e(s,t[s])}},a={distance:function(t,e){let s=e.x-t.x,i=e.y-t.y;return Math.sqrt(s*s+i*i)},arePointsColinear:function(t,e,s,i){return i=void 0===i?.01:i,Math.abs(t.x*(e.y-s.y)+e.x*(s.y-t.y)+s.x*(t.y-e.y))<=i},arePointsEqual:function(t,e){return t.x===e.x&&t.y===e.y},isPointCloseToSegment:function(t,e,s,i){i=void 0===i?.01:i;let n=s.x,a=s.y,r=e.x-t.x,h=e.y-t.y,o={};if(0===r&&0===h)o=t;else{let s=((n-t.x)*r+(a-t.y)*h)/(r*r+h*h);o.x=t.x+s*(e.x-t.x),o.y=t.y+s*(e.y-t.y)}return!!this.isPointOnSegment(t,e,o)&&(r=n-o.x,h=a-o.y,Math.sqrt(r*r+h*h)<=i)},isPointOnSegment:function(t,e,s){let i=Math.min(t.x,e.x),n=Math.max(t.x,e.x),a=Math.min(t.y,e.y),r=Math.max(t.y,e.y);return s.x>=i&&s.x<=n&&s.y>=a&&s.y<=r},getNormalVector:function(t,e,s){if(this.arePointsEqual(t,e))throw new Error("Cannot create normal vector from equal points");let i=e.x-t.x,n=e.y-t.y,a=this.distance(t,e);return s?{x:-n/a,y:i/a}:{x:n/a,y:-i/a}},getVector:function(t,e){if(this.arePointsEqual(t,e))throw new Error("Cannot create vector from equal points");let s={};return s.x=e.x-t.x,s.y=e.y-t.y,s},getUnitVector:function(t,e){let s=this.getVector(t,e),i=Math.sqrt(s.x*s.x+s.y*s.y);return s.x=s.x/i,s.y=s.y/i,s},translateVector:function(t,e){return{x:t.x+e.x,y:t.y+e.y}},vecByScalMul:function(t,e){return{x:t.x*e,y:t.y*e}},isPointInCircle:function(t,e,s){let i=Math.abs(e.x-t.x);if(i>s)return!1;let n=Math.abs(e.y-t.y);return!(n>s)&&(i+n<=s||i*i+n*n<=s*s)},getPointOnCircleGivenAngle:function(t,e,s){return{x:t.x+e*Math.cos(s),y:t.y+e*Math.sin(s)}},centerOfCircleFrom3Points:function(t,e,s){let i=t.x-s.x,n=t.y-s.y,a=e.x-s.x,r=e.y-s.y,h=2*(i*r-a*n),o=i*i+n*n,_=a*a+r*r,E={};return E.x=(r*o-n*_)/h+s.x,E.y=(i*_-a*o)/h+s.y,E},getMidAngleOfArc:function(t,e,s){let i=(t+e)/2;return t<=e&&s||t>e&&!s?i<=0?i+Math.PI:i-Math.PI:i},capValue:function(t,e,s){return Math.min(Math.max(e,t),s)}}},function(t,e,s){"use strict";s.d(e,"d",(function(){return a})),s.d(e,"a",(function(){return o})),s.d(e,"c",(function(){return E})),s.d(e,"b",(function(){return d}));var i=s(0),n=s(4);class a extends n.a{constructor(t){super(t=t||{}),this._text=t.text,this._font="1em sans-serif",this._offsetX=0,this._offsetY=0,this._width=0,this._height=0,this.configure(t),this._measureText()}configure(t){this._font=t.font||this._font,this._offsetX=void 0===t.offsetX?this._offsetX:t.offsetX,this._offsetY=void 0===t.offsetY?this._offsetY:t.offsetY}setText(t){this._text=t,this._measureText()}getWidth(){return this._width}getHeight(){return this._height}_measureText(t){t||((t=document.createElement("canvas").getContext("2d")).font=this.font),this._width=t.measureText(this._text).width,this._height=t.measureText("O").width}_decoratedDraw(t){if(this._text&&null!==this._position.x&&null!==this._position.y){t.font=this._font;let e=t.fillStyle;t.fillStyle=t.strokeStyle,this._measureText(t),t.fillText(this._text,this._position.x-this._width*this._offsetX,this._position.y+this._height*this._offsetY),t.fillStyle=e}}}class r extends n.a{constructor(t){super(t=t||{}),this._startPoint=t.start?Object.assign({},t.start):{x:0,y:0},this._distanceToleration=void 0===t.distanceToleration?5:t.distanceToleration}getStart(){return Object.assign({},this._startPoint)}getBounds(){return{left:Math.min(this._startPoint.x,this._position.x),top:Math.min(this._startPoint.y,this._position.y),right:Math.max(this._startPoint.x,this._position.x),bottom:Math.max(this._startPoint.y,this._position.y)}}setStart(t){this._startPoint.x=t.x,this._startPoint.y=t.y}contains(t){return i.b.isPointCloseToSegment(this._startPoint,this._position,t,this._distanceToleration)}_decoratedDraw(t){t.beginPath(),t.moveTo(this._startPoint.x,this._startPoint.y),t.lineTo(this._position.x,this._position.y),t.stroke()}}class h extends n.a{constructor(t){super(t=t||{}),this._radius=void 0===t.radius?0:t.radius,this._startAngle=void 0===t.start?0:t.start,this._endAngle=void 0===t.end?0:t.end,this._reverse=void 0===t.reverse?0:t.reverse,this._distanceToleration=void 0===t.distanceToleration?5:t.distanceToleration}getBounds(){let t=i.b.getPointOnCircleGivenAngle(this._position,this._radius,this._startAngle),e=i.b.getPointOnCircleGivenAngle(this._position,this._radius,i.b.getMidAngleOfArc(this._startAngle,this._endAngle,this._reverse)),s=i.b.getPointOnCircleGivenAngle(this._position,this._radius,this._endAngle);return{left:Math.min(Math.min(t.x,e.x),s.x),top:Math.min(Math.min(t.y,e.y),s.y),right:Math.max(Math.max(t.x,e.x),s.x),bottom:Math.max(Math.max(t.y,e.y),s.y)}}setStart(t){this._startAngle=t}setEnd(t){this._endAngle=t}setRadius(t){this._radius=t}setReverse(t){this._reverse=t}contains(t){if(Math.abs(i.b.distance(this._position,t)-this._radius)<=this._distanceToleration){let e={x:t.x-this._position.x,y:t.y-this._position.y},s=Math.atan2(e.y,e.x);if(this._startAngle<=this._endAngle){let t=this._startAngle<=s&&s<=this._endAngle;return this._reverse?!t:t}{let t=s>=this._startAngle||s<=this._endAngle;return this._reverse?!t:t}}return!1}_decoratedDraw(t){t.beginPath(),t.arc(this._position.x,this._position.y,this._radius,this._startAngle,this._endAngle,this._reverse),t.stroke()}}class o extends n.a{constructor(t){super(t=t||{}),this._radius=void 0===t.radius?30:t.radius}contains(t){return i.b.isPointInCircle(t,this._position,this._radius)}move(t){this._pointerOffset?super.move({x:t.x-this._pointerOffset.x,y:t.y-this._pointerOffset.y}):super.move(t)}getRadius(){return this._radius}getBounds(){return{left:this._position.x-this._radius,top:this._position.y-this._radius,right:this._position.x+this._radius,bottom:this._position.y+this._radius}}_decoratedDraw(t){t.beginPath(),t.arc(this._position.x,this._position.y,this._radius,0,2*Math.PI),t.fill(),t.stroke()}}class _ extends n.a{constructor(t){super(t=t||{}),this._rotation=void 0===t.rotation?0:t.rotation,this._height=void 0===t.height?8:t.height,this._base=void 0===t.base?8:t.base,this._vertices=null,this._calculateVertices()}move(t){super.move(t),this._calculateVertices()}rotate(t){this._rotation=t,this._calculateVertices()}getBounds(){return{left:Math.min(this._vertices.top.x,this._vertices.left.x,this._vertices.right.x),top:Math.min(this._vertices.top.y,this._vertices.left.y,this._vertices.right.y),right:Math.max(this._vertices.top.x,this._vertices.left.x,this._vertices.right.x),bottom:Math.max(this._vertices.top.y,this._vertices.left.y,this._vertices.right.y)}}_calculateVertices(){let t=this._position,e={x:-Math.cos(this._rotation)*this._height+t.x,y:-Math.sin(this._rotation)*this._height+t.y},s=i.b.getNormalVector(e,t),n={x:-s.x,y:-s.y},a=i.b.translateVector(i.b.vecByScalMul(s,this._base/2),e),r=i.b.translateVector(i.b.vecByScalMul(n,this._base/2),e);this._vertices={top:t,left:a,right:r}}_decoratedDraw(t){t.beginPath(),t.moveTo(this._vertices.top.x,this._vertices.top.y),t.lineTo(this._vertices.left.x,this._vertices.left.y),t.lineTo(this._vertices.right.x,this._vertices.right.y),t.fill(),t.stroke()}}class E extends r{constructor(t){(t=t||{}).fill=!0,super(t),this._arrowTip=null,this._updateArrowTip()}move(t){super.move(t),this._updateArrowTip()}setStart(t){super.setStart(t),this._updateArrowTip()}_updateArrowTip(){let t=this._startPoint,e=this._position;if(i.b.arePointsEqual(t,e))this._arrowTip=null;else{let s=i.b.getVector(t,e),n=Math.atan2(s.y,s.x);this._arrowTip?(this._arrowTip.move(e),this._arrowTip.rotate(n)):this._arrowTip=new _({position:e,rotation:n})}}_decoratedDraw(t){super._decoratedDraw(t),this._arrowTip&&this._arrowTip._decoratedDraw(t)}}class d extends h{constructor(t){(t=t||{}).fill=!0,super(t),this._arrowTip=null,this._updateArrowTip()}move(t){super.move(t),this._updateArrowTip()}setStart(t){super.setStart(t),this._updateArrowTip()}setEnd(t){super.setEnd(t),this._updateArrowTip()}setRadius(t){super.setRadius(t),this._updateArrowTip()}setReverse(t){super.setReverse(t),this._updateArrowTip()}_updateArrowTip(){if(this._startAngle!==this._endAngle){let t=this._reverse?1:-1,e=i.b.getPointOnCircleGivenAngle(this._position,this._radius,this._endAngle),s=i.b.getPointOnCircleGivenAngle(this._position,this._radius,this._endAngle+10*t/this._radius),n=i.b.getVector(s,e),a=Math.atan2(n.y,n.x);this._arrowTip?(this._arrowTip.move(e),this._arrowTip.rotate(a)):this._arrowTip=new _({position:e,rotation:a})}else this._arrowTip=null}_decoratedDraw(t){super._decoratedDraw(t),this._arrowTip&&this._arrowTip._decoratedDraw(t)}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return n}));var i=s(1);class n extends i.a{constructor(t){(t=t||{}).isHoverable=!0,t.isSelectable=!0,t.isMovable=!0,t.isPullable=!0,super(t),this.isAccepting=void 0!==t.accept&&t.accept,this.isEntry=void 0!==t.entry&&t.entry,this._isActive=!1,this._textBox=new i.d({position:this._position,text:t.text||"",offsetX:.5,offsetY:.5}),this._entryArrow=null}accept(t){this.isAccepting=!!t}setActive(t){this._isActive=!!t}setAsEntry(t){this.isEntry=!!t}setText(t){this._textBox.setText(t)}getText(){return this._textBox._text}move(t){super.move(t),this._textBox.move(this._position)}_decoratedDraw(t){if(this._isActive&&(t.fillStyle="#B2DFEE",t.strokeStyle="#000000"),super._decoratedDraw(t),this._textBox._decoratedDraw(t),this.isAccepting&&(t.beginPath(),t.arc(this._position.x,this._position.y,.85*this._radius,0,2*Math.PI),t.stroke()),this.isEntry){let e=t.fillStyle,s=t.strokeStyle;t.fillStyle="#000000",t.strokeStyle="#000000",t.beginPath(),t.arc(this._position.x-2*this._radius,this._position.y,.3*this._radius,0,2*Math.PI),t.fill(),this._entryArrow?(this._entryArrow.move({x:this._position.x-this._radius,y:this._position.y}),this._entryArrow.setStart({x:this._position.x-2*this._radius,y:this._position.y})):this._entryArrow=new i.c({start:{x:this._position.x-2*this._radius,y:this._position.y},position:{x:this._position.x-this._radius,y:this._position.y}}),this._entryArrow._decoratedDraw(t),t.fillStyle=e,t.strokeStyle=s}}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return r}));var i=s(0),n=s(4),a=s(1);class r extends n.a{constructor(t){if((t=t||{}).isHoverable=!0,t.isSelectable=!0,t.isMovable=!0,t.isPullable=!0,t.fill=!0,super(t),!t.first)throw new Error("You need to specify at least one state for a transition");this.isSet=!!t.second,this.firstItem=t.first,this.secondItem=t.second||t.first,this._sagitta=void 0===t.sagitta?0:t.sagitta,this._isReversed=!!t.reverse,this._selfLinkDistance=void 0===t.selfLinkSize?30:t.selfLinkSize,this._selfLinkDirection=t.selfLinkDirection||{x:0,y:-1},this._selfLinkAngle=.75,this._colinearTolerance=5,this._textMargin=void 0===t.textMargin?10:t.textMargin,this._textBox=new a.d({position:this._position,text:t.text||"",offsetX:0,offsetY:0}),this._lastData=null,this._arrow=null,this._updateArrowIfNeeded()}setText(t){void 0!==t&&""!==t.trim()||(t="$"),this._textBox.setText(t)}getBounds(){return this._arrow.getBounds()}getText(){return this._textBox._text}getConditions(){return this.getText().split(", ")}isSelfLink(){return this.firstItem===this.secondItem}contains(t){return this._updateArrowIfNeeded(),this._arrow.contains(t)}move(t){if(super.move(t),this.isSelfLink())i.b.arePointsEqual(this.firstItem.getPosition(),this._position)||(this._selfLinkDirection=i.b.getUnitVector(this.firstItem.getPosition(),this._position));else if(this.isSet)if(i.b.arePointsColinear(this.firstItem.getPosition(),this.secondItem.getPosition(),this._position,this._colinearTolerance))this._sagitta=0;else{let t=this.firstItem.getPosition(),e=this.secondItem.getPosition(),s={x:(t.x+e.x)/2,y:(t.y+e.y)/2};if(i.b.arePointsEqual(t,e))this._sagitta=0;else{let n=i.b.centerOfCircleFrom3Points(t,e,this.getPosition()),a={x:this._position.x-t.x,y:this._position.y-t.y},r={x:this._position.x-e.x,y:this._position.y-e.y};this._isReversed=a.x*r.y-r.x*a.y>0;let h=i.b.getNormalVector(t,e,this._isReversed),o=i.b.distance(n,t),_=Math.atan2(h.y,h.x),E=i.b.getPointOnCircleGivenAngle(n,o,_);this._sagitta=i.b.distance(s,E)}}}setEndTemporarily(t){this.secondItem=t}setEnd(t){this.secondItem=t,this.isSet=!0}select(t){super.select(t),this._arrow.select(t)}unselect(){super.unselect(),this._arrow.unselect()}pointerOver(){super.pointerOver(),this._arrow.pointerOver()}pointerOut(){super.pointerOut(),this._arrow.pointerOut()}_createSelfTransition(){let t={},e=this.firstItem.getPosition(),s=Math.atan2(this._selfLinkDirection.y,this._selfLinkDirection.x),n=i.b.getPointOnCircleGivenAngle(e,this.firstItem.getRadius(),s),r=i.b.getPointOnCircleGivenAngle(e,this.firstItem.getRadius(),s-this._selfLinkAngle/2),h=i.b.getPointOnCircleGivenAngle(e,this.firstItem.getRadius(),s+this._selfLinkAngle/2);t.center=i.b.centerOfCircleFrom3Points(r,h,i.b.translateVector(i.b.vecByScalMul(this._selfLinkDirection,this._selfLinkDistance),n)),t.radius=i.b.distance(t.center,r),t.startAngle=Math.atan2(r.y-t.center.y,r.x-t.center.x),t.endAngle=Math.atan2(h.y-t.center.y,h.x-t.center.x),t.reverse=!1,this._applyArrowChanges(a.b,t)}_createStraightTransition(){let t=this.firstItem.getPosition(),e=this.secondItem?this.secondItem.getPosition():this.getPosition();if(!i.b.arePointsEqual(t,e)){let s=i.b.translateVector(i.b.vecByScalMul(i.b.getUnitVector(t,e),this.firstItem.getRadius()),this.firstItem.getPosition());if(this.secondItem){e=i.b.translateVector(i.b.vecByScalMul(i.b.getUnitVector(e,t),this.secondItem.getRadius()),this.secondItem.getPosition())}t=s}this._applyArrowChanges(a.c,{from:t,to:e})}_createCircularTransition(){let t={},e=this.firstItem.getPosition(),s=this.secondItem.getPosition(),n={x:(e.x+s.x)/2,y:(e.y+s.y)/2};if(i.b.arePointsEqual(e,s))t={center:{x:0,y:0},startAngle:0,endAngle:0,radius:0};else{let a=i.b.getNormalVector(e,s,this._isReversed),r=i.b.translateVector(i.b.vecByScalMul(a,this._sagitta),n);t.center=i.b.centerOfCircleFrom3Points(e,s,r),t.radius=i.b.distance(t.center,e),t.reverse=this._isReversed;let h=this._isReversed?1:-1;t.startAngle=Math.atan2(e.y-t.center.y,e.x-t.center.x)-2*h*Math.asin(this.firstItem.getRadius()/(2*t.radius)),t.endAngle=Math.atan2(s.y-t.center.y,s.x-t.center.x)+2*h*Math.asin(this.secondItem.getRadius()/(2*t.radius))}this._applyArrowChanges(a.b,t)}_applyArrowChanges(t,e){t===a.c?this._arrow instanceof a.c?(this._arrow.setStart(e.from),this._arrow.move(e.to)):(this._arrow=new a.c({start:e.from,position:e.to,isMovable:!0,isSelectable:!0,isHoverable:!0,isPullable:!0}),this._arrow._visualState=this._visualState):t===a.b&&(this._arrow instanceof a.b?(this._arrow.move(e.center),this._arrow.setStart(e.startAngle),this._arrow.setEnd(e.endAngle),this._arrow.setRadius(e.radius),this._arrow.setReverse(e.reverse)):(this._arrow=new a.b({start:e.startAngle,end:e.endAngle,position:e.center,radius:e.radius,reverse:e.reverse,isMovable:!0,isSelectable:!0,isHoverable:!0,isPullable:!1}),this._arrow._visualState=this._visualState)),this._repositionText(t,e)}_repositionText(t,e){let s={x:null,y:null},n=null,r=null;if(t!==a.c||i.b.arePointsEqual(e.from,e.to)){if(t===a.b&&e.radius){const t=e.radius+this._textMargin;s=i.b.getPointOnCircleGivenAngle(e.center,t,i.b.getMidAngleOfArc(e.startAngle,e.endAngle,e.reverse));const a=this._calculateOffsets(e.center,t,s);n=a.x,r=a.y}}else{const t=i.b.translateVector(i.b.vecByScalMul(i.b.getVector(e.from,e.to),.5),e.from),a=i.b.getNormalVector(e.from,e.to,!1);s=i.b.translateVector(i.b.vecByScalMul(a,this._textMargin),t);const h=i.b.distance(e.from,e.to)/2+this._textMargin,o=i.b.translateVector(i.b.vecByScalMul(a,-h),s),_=this._calculateOffsets(o,h,s);n=_.x,r=_.y}this._textBox.move(s),this._textBox.configure({offsetX:n,offsetY:r})}_calculateOffsets(t,e,s){const i=s.y-t.y,n=Math.abs(i+e)/(2*e),a=s.x-(t.x-e),r=this._textBox.getWidth()/this._textBox.getHeight();return{x:1/(1+Math.exp(r*(a/e-1))),y:n}}_updateArrowIfNeeded(){let t=this.firstItem.getPosition(),e=this.secondItem?this.secondItem.getPosition():this.getPosition(),s=this.getPosition(),i=this._textBox._text;this.isSelfLink()?this._updateNeeded(t,null,s,i)&&this._createSelfTransition():this.isSet&&0!==this._sagitta?this._updateNeeded(t,e,s,i)&&this._createCircularTransition():this._updateNeeded(t,e,s,i)&&this._createStraightTransition(),this._lastData={from:t,to:e,position:s,text:this._textBox._text}}_updateNeeded(t,e,s,n){if(!this._lastData)return!0;let a=!!t&&!i.b.arePointsEqual(this._lastData.from,t),r=!!e&&!i.b.arePointsEqual(this._lastData.to,e),h=!!s&&!i.b.arePointsEqual(this._lastData.position,s),o=void 0!==n&&this._lastData.text!==n;return a||r||h||o}_decoratedDraw(t){this._updateArrowIfNeeded(),this._arrow._decoratedDraw(t),this._textBox._decoratedDraw(t)}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return i}));class i{constructor(t){t=t||{},this._position=t.position?Object.assign({},t.position):{x:0,y:0},this.isHoverable=!!t.isHoverable,this.isSelectable=!!t.isSelectable,this.isMovable=!!t.isMovable,this.isPullable=!!t.isPullable,this.fill=!!t.fill,this._visualState="default",this._pointerOffset=null}contains(t){return!1}draw(t){if(null!==this._position.x&&null!==this._position.y){switch(t.save(),this._visualState){case"default":t.strokeStyle="#000000",t.fillStyle="#FFFFFF";break;case"hovered":t.strokeStyle="#3BA7FF",t.fillStyle="#FFFFFF";break;case"selected":t.strokeStyle="#336699",t.fillStyle="#FFFFFF";break;default:throw new Error("There is no "+this._visualState+" visual state defined.")}t.fillStyle=this.fill?t.strokeStyle:"#FFFFFF",this._decoratedDraw(t),t.restore()}}getBounds(){return{left:this._position.x,top:this._position.y,right:this._position.x,bottom:this._position.y}}getPosition(){return Object.assign({},this._position)}move(t){this._position.x=t.x,this._position.y=t.y}select(t){this._visualState="selected",t&&(this._pointerOffset={x:t.x-this._position.x,y:t.y-this._position.y})}unselect(){this._visualState="default",this._pointerAnchor=null}pointerOver(){"selected"!==this._visualState&&(this._visualState="hovered")}pointerOut(){"selected"!==this._visualState&&(this._visualState="default")}_decoratedDraw(t){}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return i}));class i{constructor(t,e){this.SET_TRANSFORM="canvas-set-transform",this.GET_SIZE="canvas-get-size",this.CLEAR_CANVAS="canvas-clear",this.DRAW_ON_CANVAS="canvas-draw",this.REDRAW_CANVAS="canvas-redraw",this.CANVAS_CLEARED_EVENT="canvas-cleared",this.CANVAS_DRAWN_EVENT="canvas-drawn",this.CANVAS_RESIZED_EVENT="canvas-resized",this.APPEND_DOM_ELEMENT="append-dom-element",this.GET_APP_SIZE="get-app-size",this.ADD_MOUSE_LISTENERS="add-mouse-listeners",this.APP_INIT_EVENT="app-init",this.APP_RESIZED_EVENT="app-resized",this.isInit=!1,this.isRunning=!1,this._isInteractive=!(!e||void 0===e.isInteractive)&&e.isInteractive,this._size=e.size||{width:"auto",height:"auto"},this._minSize=e.minSize||{width:0,height:0},this._transform=e.transform,this._sandbox=t,this._canvas,this._context}init(){this.isInit||(this._sandbox.registerListener(this.APP_INIT_EVENT,{callback:this.onAppInit,thisArg:this}),this._sandbox.createEvent(this.CANVAS_CLEARED_EVENT),this._sandbox.createEvent(this.CANVAS_DRAWN_EVENT),this._sandbox.createEvent(this.CANVAS_RESIZED_EVENT),this.isInit=!0)}start(){this.isRunning||(this._sandbox.registerMessageReceiver(this.CLEAR_CANVAS,this.clear.bind(this)),this._sandbox.registerMessageReceiver(this.DRAW_ON_CANVAS,this.draw.bind(this)),this._sandbox.registerMessageReceiver(this.REDRAW_CANVAS,this.redraw.bind(this)),this._sandbox.registerMessageReceiver(this.SET_TRANSFORM,this.setTransform.bind(this)),this._sandbox.registerMessageReceiver(this.GET_SIZE,this.getSize.bind(this)),this.isRunning=!0)}onAppInit(){this._sandbox.unregisterListener(this.APP_INIT_EVENT,this.onAppInit);let t=this._size.width,e=this._size.height;if("auto"===this._size.width||"auto"===this._size.height){let s=this._sandbox.sendMessage(this.GET_APP_SIZE);t="auto"===this._size.width?Math.max(s.width,this._minSize.width):this._size.width,e="auto"===this._size.height?Math.max(s.height,this._minSize.height):this._size.height,this._sandbox.registerListener(this.APP_RESIZED_EVENT,{callback:this._onAppResized,thisArg:this})}this._canvas=this._sandbox.sendMessage(this.APPEND_DOM_ELEMENT,{type:"canvas",width:t,height:e}),this._context=this._canvas.getContext("2d",{alpha:!1}),this._isInteractive&&this._sandbox.sendMessage(this.ADD_MOUSE_LISTENERS,this._canvas),this.clear(),this._sandbox.raiseEvent(this.CANVAS_RESIZED_EVENT,{width:t,height:e})}clear(){this._context.save(),this._context.fillStyle="#FFFFFF",this._context.fillRect(0,0,this._canvas.width,this._canvas.height),this._context.restore(),this._sandbox.raiseEvent(this.CANVAS_CLEARED_EVENT,this._canvas)}draw(t){if(this._context.save(),this._transform&&this._transform(this._context),t instanceof Array)for(let e=0,s=t.length;e<s;e++)t[e].draw(this._context);else t.draw(this._context);this._context.restore(),this._sandbox.raiseEvent(this.CANVAS_DRAWN_EVENT,{canvas:this._canvas,drawables:t})}redraw(t){this.clear(),this.draw(t)}getSize(){return{width:this._canvas.width,height:this._canvas.height}}resize(t){this._canvas.width=t.width,this._canvas.height=t.height,this.clear(),this._sandbox.raiseEvent(this.CANVAS_RESIZED_EVENT,t)}setTransform(t){this._transform=t}stop(){this.isRunning&&(this.isRunning=!1,this._sandbox.unregisterMessageReceiver(this.CLEAR_CANVAS),this._sandbox.unregisterMessageReceiver(this.DRAW_ON_CANVAS),this._sandbox.unregisterMessageReceiver(this.REDRAW_CANVAS),this._sandbox.unregisterMessageReceiver(this.SET_TRANSFORM),this._sandbox.unregisterMessageReceiver(this.GET_SIZE))}cleanUp(){this._sandbox.unregisterListener(this.APP_RESIZED_EVENT,this._onAppResized),this._sandbox.deleteEvent(this.CANVAS_CLEARED_EVENT),this._sandbox.deleteEvent(this.CANVAS_DRAWN_EVENT)}_onAppResized(t){this.isRunning&&this.resize({width:"auto"===this._size.width?Math.max(t.width,this._minSize.width):this._size.width,height:"auto"===this._size.height?Math.max(t.height,this._minSize.height):this._size.height})}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return n}));var i=s(0);class n{constructor(t,e){this.APPEND_DOM_ELEMENT="append-dom-element",this.GET_ELEMENT_BY_ID="get-element-by-id",this.GET_ELEMENTS_BY_TAG="get-element-by-tag",this.SET_CONTROL_DISABLED="disable-control",this.GET_APP_SIZE="get-app-size",this.APP_RESIZED_EVENT="app-resized",this.ADD_KEY_LISTENER="add-key-listener",this.REMOVE_KEY_LISTENER="remove-key-listener",this.APP_INIT_EVENT="app-init",this._windowResizedBind=this._onWindowResized.bind(this),this.isInit=!1,this.isRunning=!1,this._sandbox=t,this._outerElement=e.entrypoint?document.getElementById(e.entrypoint):document.body}init(){this.isInit||(this._sandbox.registerListener(this.APP_INIT_EVENT,{callback:this.onAppInit,thisArg:this}),this._sandbox.createEvent(this.APP_RESIZED_EVENT),this.isInit=!0)}start(){this.isRunning||(this._sandbox.registerMessageReceiver(this.APPEND_DOM_ELEMENT,this.appendDomElement.bind(this)),this._sandbox.registerMessageReceiver(this.GET_ELEMENT_BY_ID,this.getElementById),this._sandbox.registerMessageReceiver(this.GET_ELEMENTS_BY_TAG,this.getElementsByTag),this._sandbox.registerMessageReceiver(this.GET_APP_SIZE,this.getAppSize.bind(this)),this._sandbox.registerMessageReceiver(this.SET_CONTROL_DISABLED,this.setControlDisabled.bind(this)),window.addEventListener("resize",this._windowResizedBind),this.isRunning=!0)}onAppInit(){this._sandbox.unregisterListener(this.APP_INIT_EVENT,this.onAppInit)}appendDomElement(t){if(!t||!t.type)throw new Error("You need to provide configuration for the DOM element to append");let e=document.createElement(t.type);return t.type=null,t.style&&(i.c.forEachOwnProperty(t.style,(t,s)=>{e.style[t]=s}),t.style=null),t.rawContent?t.rawContent=null:t.domContent&&(t.domContent=null),i.c.forEachOwnProperty(t,(t,s)=>{null!==e.hasAttribute(t)&&null!==s&&e.setAttribute(t,s)}),this._outerElement.appendChild(e),e}getElementById(t){const e=document.getElementById(t.id);return!t.predicate||t.predicate(e)?e:null}getElementsByTag(t){return Array.prototype.slice.call(document.getElementsByTagName(t))}getAppSize(){let t=this._outerElement.getBoundingClientRect();return{width:t.width,height:t.height}}setControlDisabled(t){let e=document.getElementById(t.id);e&&"disabled"in e&&(e.disabled=!!t.disabled)}stop(){this.isRunning&&(this.isRunning=!1,window.removeEventListener("resize",this._windowResizedBind),this._sandbox.unregisterMessageReceiver(this.APPEND_DOM_ELEMENT),this._sandbox.unregisterMessageReceiver(this.GET_ELEMENT_BY_ID),this._sandbox.unregisterMessageReceiver(this.GET_ELEMENTS_BY_TAG),this._sandbox.unregisterMessageReceiver(this.GET_APP_SIZE),this._sandbox.unregisterMessageReceiver(this.SET_CONTROL_DISABLED))}cleanUp(){}_onWindowResized(t){this._sandbox.raiseEvent(this.APP_RESIZED_EVENT,this.getAppSize())}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return i}));class i{constructor(t){this.ADD_BUTTON_LISTENER="add-button-listener",this.ADD_KEY_LISTENER="add-key-listener",this.ADD_MOUSE_LISTENERS="add-mouse-listeners",this.REMOVE_BUTTON_LISTENER="remove-button-listener",this.REMOVE_KEY_LISTENER="remove-key-listener",this.REMOVE_MOUSE_LISTENERS="remove-mouse-listeners",this.PREVENT_SCROLLING="prevent-scrolling",this.DOUBLE_CLICK_EVENT="double-click",this.POINTER_DOWN_EVENT="pointer-down",this.POINTER_MOVE_EVENT="pointer-move",this.POINTER_UP_EVENT="pointer-up",this.GET_ELEMENT_BY_ID="get-element-by-id",this.APP_INIT_EVENT="app-init",this.isInit=!1,this.isRunning=!1,this._sandbox=t,this._keyDownListeners=new Map,this._bindedListeners=Object.create(null),this._isScrollingEnabled=!0}init(){if(!this.isInit){this._sandbox.registerListener(this.APP_INIT_EVENT,{callback:this.onAppInit,thisArg:this}),this._sandbox.createEvent(this.DOUBLE_CLICK_EVENT),this._sandbox.createEvent(this.POINTER_DOWN_EVENT),this._sandbox.createEvent(this.POINTER_MOVE_EVENT),this._sandbox.createEvent(this.POINTER_UP_EVENT),Object.getOwnPropertyNames(Object.getPrototypeOf(this)).forEach(t=>{"function"==typeof this[t]&&t.startsWith("_handle")&&(this._bindedListeners[t]=this[t].bind(this))}),this.isInit=!0}}start(){this.isRunning||(this._sandbox.registerMessageReceiver(this.ADD_BUTTON_LISTENER,this.addButtonListener.bind(this)),this._sandbox.registerMessageReceiver(this.ADD_KEY_LISTENER,this.addKeyListener.bind(this)),this._sandbox.registerMessageReceiver(this.ADD_MOUSE_LISTENERS,this.addMouseListeners.bind(this)),this._sandbox.registerMessageReceiver(this.REMOVE_BUTTON_LISTENER,this.removeButtonListener.bind(this)),this._sandbox.registerMessageReceiver(this.REMOVE_KEY_LISTENER,this.removeKeyListener.bind(this)),this._sandbox.registerMessageReceiver(this.REMOVE_MOUSE_LISTENERS,this.removeMouseListeners.bind(this)),this._sandbox.registerMessageReceiver(this.PREVENT_SCROLLING,t=>this._isScrollingEnabled=!!t),document.addEventListener("keydown",this._bindedListeners[this._handleKeyDown.name]),this.isRunning=!0)}onAppInit(){this._sandbox.unregisterListener(this.APP_INIT_EVENT,this.onAppInit)}addButtonListener(t){let e=this._sandbox.sendMessage(this.GET_ELEMENT_BY_ID,{id:t.id});e&&e.addEventListener("click",t.listener)}addKeyListener(t){this._keyDownListeners.has(t.key)?this._keyDownListeners.get(t.key).push(t.listener):this._keyDownListeners.set(t.key,[t.listener])}addMouseListeners(t){t.addEventListener("selectstart",this._bindedListeners[this._handleSelectStart.name],!1),t.addEventListener("dblclick",this._bindedListeners[this._handleDoubleClick.name]),t.addEventListener("mousedown",this._bindedListeners[this._handleMouseDown.name]),t.addEventListener("mousemove",this._bindedListeners[this._handleMouseMove.name]),t.addEventListener("mouseup",this._bindedListeners[this._handleMouseUp.name]),t.addEventListener("touchstart",this._bindedListeners[this._handleTouchStart.name]),t.addEventListener("touchend",this._bindedListeners[this._handleTouchEnd.name]),t.addEventListener("touchcancel",this._bindedListeners[this._handleTouchCancel.name]),t.addEventListener("touchmove",this._bindedListeners[this._handleTouchMove.name])}removeButtonListener(){let t=this._sandbox.sendMessage(this.GET_ELEMENT_BY_ID,{id:data.id});t&&t.removeEventListener("click",data.listener)}removeKeyListener(t){if(this._keyDownListeners.has(t.key)){let e=this._keyDownListeners.get(t.key);for(let s=0;s<e.length;s++)e[s]===t.listener&&e.splice(s,1)}}removeMouseListeners(t){t.removeEventListener("selectstart",this._bindedListeners[this._handleSelectStart.name]),t.removeEventListener("dblclick",this._bindedListeners[this._handleDoubleClick.name]),t.removeEventListener("mousedown",this._bindedListeners[this._handleMouseDown.name]),t.removeEventListener("mousemove",this._bindedListeners[this._handleMouseMove.name]),t.removeEventListener("mouseup",this._bindedListeners[this._handleMouseUp.name]),t.removeEventListener("touchstart",this._bindedListeners[this._handleTouchStart.name]),t.removeEventListener("touchend",this._bindedListeners[this._handleTouchEnd.name]),t.removeEventListener("touchcancel",this._bindedListeners[this._handleTouchCancel.name]),t.removeEventListener("touchmove",this._bindedListeners[this._handleTouchMove.name])}stop(){this.isRunning&&(this.isRunning=!1,document.removeEventListener("keydown",this._bindedListeners[this._handleKeyDown.name]),this._sandbox.unregisterMessageReceiver(this.ADD_BUTTON_LISTENER),this._sandbox.unregisterMessageReceiver(this.ADD_KEY_LISTENER),this._sandbox.unregisterMessageReceiver(this.ADD_MOUSE_LISTENERS),this._sandbox.unregisterMessageReceiver(this.REMOVE_BUTTON_LISTENER),this._sandbox.unregisterMessageReceiver(this.REMOVE_KEY_LISTENER),this._sandbox.unregisterMessageReceiver(this.REMOVE_MOUSE_LISTENERS))}cleanUp(){this._sandbox.deleteEvent(this.DOUBLE_CLICK_EVENT),this._sandbox.deleteEvent(this.POINTER_DOWN_EVENT),this._sandbox.deleteEvent(this.POINTER_MOVE_EVENT),this._sandbox.deleteEvent(this.POINTER_UP_EVENT)}_getPointInElement(t,e,s){var i=t.getBoundingClientRect();return{x:e-i.left,y:s-i.top}}_handleKeyDown(t){if(this._keyDownListeners.has(t.key)){let e=this._keyDownListeners.get(t.key).slice();for(let t=0;t<e.length;t++)e[t]()}}_handleSelectStart(t){return t.preventDefault(),!1}_handleDoubleClick(t){var e=this._getPointInElement(t.target,t.clientX,t.clientY);this._sandbox.raiseEvent(this.DOUBLE_CLICK_EVENT,{target:t.target,x:e.x,y:e.y,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey})}_handleMouseDown(t){var e=this._getPointInElement(t.target,t.clientX,t.clientY);this._sandbox.raiseEvent(this.POINTER_DOWN_EVENT,{target:t.target,x:e.x,y:e.y,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey})}_handleMouseMove(t){var e=this._getPointInElement(t.target,t.clientX,t.clientY);this._sandbox.raiseEvent(this.POINTER_MOVE_EVENT,{target:t.target,x:e.x,y:e.y,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey})}_handleMouseUp(t){var e=this._getPointInElement(t.target,t.clientX,t.clientY);this._sandbox.raiseEvent(this.POINTER_UP_EVENT,{target:t.target,x:e.x,y:e.y,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey})}_handleTouchStart(t){let e=t.changedTouches[0];var s=this._getPointInElement(t.target,e.clientX,e.clientY);this._sandbox.raiseEvent(this.POINTER_DOWN_EVENT,{target:t.target,x:s.x,y:s.y,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey})}_handleTouchEnd(t){let e=t.changedTouches[0];var s=this._getPointInElement(t.target,e.clientX,e.clientY);this._sandbox.raiseEvent(this.POINTER_UP_EVENT,{target:t.target,x:s.x,y:s.y,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey})}_handleTouchCancel(t){let e=t.changedTouches[0];var s=this._getPointInElement(t.target,e.clientX,e.clientY);this._sandbox.raiseEvent(this.POINTER_UP_EVENT,{target:t.target,x:s.x,y:s.y,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey})}_handleTouchMove(t){this._isScrollingEnabled||t.preventDefault();let e=t.changedTouches[0];var s=this._getPointInElement(t.target,e.clientX,e.clientY);this._sandbox.raiseEvent(this.POINTER_MOVE_EVENT,{target:t.target,x:s.x,y:s.y,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey})}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return i}));class i{constructor(t){this.ADD_ITEM="workspace-add-item",this.GET_ITEMS="workspace-get-items",this.GET_ITEM_AT="workspace-get-item",this.REMOVE_ITEM="workspace-remove-item",this.ADD_BUTTON_LISTENER="add-button-listener",this.ADD_KEY_LISTENER="add-key-listener",this.REMOVE_BUTTON_LISTENER="remove-button-listener",this.REMOVE_KEY_LISTENER="remove-key-listener",this.REFRESH_WORKSPACE="workspace-refresh",this.ITEM_ADDED_EVENT="workspace-item-added",this.ITEM_DELETED_EVENT="workspace-item-deleted",this.SELECT_ITEM="workspace-select-item",this.GET_SELECTED_ITEM="workspace-get-selection",this.DRAW_ON_CANVAS="canvas-draw",this.REDRAW_CANVAS="canvas-redraw",this.APP_INIT_EVENT="app-init",this.CANVAS_RESIZED_EVENT="canvas-resized",this.DRAWABLE_INTERFACE="drawable-interface",this.HOVERABLE_INTERFACE="hoverable-interface",this.MOVABLE_INTERFACE="movable-interface",this.SELECTABLE_INTERFACE="selectable-interface",this.isInit=!1,this.isRunning=!1,this._sandbox=t,this._items=[],this._deleteSelectedBind=this._deleteSelected.bind(this)}init(){this.isInit||(this._sandbox.registerListener(this.APP_INIT_EVENT,{callback:this.onAppInit,thisArg:this}),this._sandbox.createEvent(this.ITEM_ADDED_EVENT),this._sandbox.createEvent(this.ITEM_DELETED_EVENT),this._sandbox.declareInterface(this.DRAWABLE_INTERFACE,["draw"],[]),this._sandbox.declareInterface(this.HOVERABLE_INTERFACE,["contains","pointerOver","pointerOut"],["isHoverable"]),this._sandbox.declareInterface(this.MOVABLE_INTERFACE,["move","getPosition"],["isMovable"]),this._sandbox.declareInterface(this.SELECTABLE_INTERFACE,["contains","select","unselect"],["isSelectable"]),this.isInit=!0)}start(){this.isRunning||(this._sandbox.registerListener(this.CANVAS_RESIZED_EVENT,{callback:this._onCanvasResized,thisArg:this}),this._sandbox.registerMessageReceiver(this.ADD_ITEM,this.addItem.bind(this)),this._sandbox.registerMessageReceiver(this.REMOVE_ITEM,this.removeItem.bind(this)),this._sandbox.registerMessageReceiver(this.GET_ITEM_AT,this.getItemAt.bind(this)),this._sandbox.registerMessageReceiver(this.GET_ITEMS,this.getItems.bind(this)),this._sandbox.registerMessageReceiver(this.REFRESH_WORKSPACE,this.refresh.bind(this)),this.isRunning=!0)}onAppInit(){this._sandbox.unregisterListener(this.APP_INIT_EVENT,this.onAppInit),this._sandbox.sendMessage(this.ADD_KEY_LISTENER,{key:"Delete",listener:this._deleteSelectedBind}),this._sandbox.sendMessage(this.ADD_BUTTON_LISTENER,{id:"delete",listener:this._deleteSelectedBind})}addItem(t){this._sandbox.assertInterface(t,this.DRAWABLE_INTERFACE),t.isHoverable&&this._sandbox.assertInterface(t,this.HOVERABLE_INTERFACE),t.isMovable&&this._sandbox.assertInterface(t,this.MOVABLE_INTERFACE),t.isSelectable&&this._sandbox.assertInterface(t,this.SELECTABLE_INTERFACE),this._items.push(t),this._sandbox.sendMessage(this.DRAW_ON_CANVAS,t),this._sandbox.raiseEvent(this.ITEM_ADDED_EVENT,t)}removeItem(t){for(let e=0,s=this._items.length;e<s;e++)if(this._items[e]===t)return this._items.splice(e,1),this._sandbox.sendMessage(this.REDRAW_CANVAS,this._items),void this._sandbox.raiseEvent(this.ITEM_DELETED_EVENT,{item:t})}getItemAt(t){let e=t.point,s=this._items;for(let i=s.length-1;i>=0;i--){let n=s[i];if(n.contains&&n.contains(e)&&(!t.predicate||t.predicate(n)))return n}return null}getItems(t){return t?this._items.filter(t):this._items.slice()}refresh(){this._sandbox.sendMessage(this.REDRAW_CANVAS,this._items)}stop(){this.isRunning&&(this._sandbox.unregisterMessageReceiver(this.ADD_ITEM),this._sandbox.unregisterMessageReceiver(this.REMOVE_ITEM),this._sandbox.unregisterMessageReceiver(this.GET_ITEM_AT),this._sandbox.unregisterMessageReceiver(this.GET_ITEMS),this._sandbox.unregisterMessageReceiver(this.REFRESH_WORKSPACE),this._sandbox.unregisterListener(this.CANVAS_RESIZED_EVENT,this._onCanvasResized),this.isRunning=!1)}cleanUp(){this._sandbox.deleteEvent(this.ITEM_ADDED_EVENT),this._sandbox.deleteEvent(this.ITEM_DELETED_EVENT),this._sandbox.sendMessage(this.REMOVE_KEY_LISTENER,{key:"Delete",listener:this._deleteSelectedBind}),this._sandbox.sendMessage(this.REMOVE_BUTTON_LISTENER,{id:"delete",listener:this._deleteSelectedBind})}_deleteSelected(){if(this.isRunning){let t=this._sandbox.sendMessage(this.GET_SELECTED_ITEM);t&&(this._sandbox.sendMessage(this.SELECT_ITEM,{item:null}),this.removeItem(t))}}_onCanvasResized(t){this.refresh()}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return i}));class i{constructor(t,e){this.SAVE_CACHE="fsm-save-cache",this.LOAD_CACHE="fsm-load-cache",this.CLEAR_CACHE="fsm-clear-cache",this.SERIALIZE_FSM="fsm-serialize",this.DESERIALIZE_FSM="fsm-deserialize",this.APP_INIT_EVENT="app-init",this.STATE_CREATED_EVENT="fsm-state-created",this.STATE_EDITED_EVENT="fsm-state-edited",this.STATE_DELETED_EVENT="fsm-state-edited",this.TRANSITION_CREATED_EVENT="fsm-transition-created",this.TRANSITION_EDITED_EVENT="fsm-transition-edited",this.TRANSITION_DELETED_EVENT="fsm-transition-edited",this.isInit=!1,this.isRunning=!1,this._sandbox=t,e=e||{},this._saveSpan=5e3,this._lastSave=null,this._isWaiting=!1,this._autosaving=!!e.autosaving}init(){this.isInit||(this._sandbox.registerListener(this.APP_INIT_EVENT,{callback:this.onAppInit,thisArg:this}),this.isInit=!0)}start(){this.isRunning||(this._sandbox.registerMessageReceiver(this.SAVE_CACHE,this.saveCache.bind(this)),this._sandbox.registerMessageReceiver(this.LOAD_CACHE,this.loadCache.bind(this)),this._sandbox.registerMessageReceiver(this.CLEAR_CACHE,this.clearCache.bind(this)),this._autosaving&&(this._sandbox.registerListener(this.STATE_CREATED_EVENT,{callback:this._saveChanges,thisArg:this}),this._sandbox.registerListener(this.STATE_EDITED_EVENT,{callback:this._saveChanges,thisArg:this}),this._sandbox.registerListener(this.STATE_DELETED_EVENT,{callback:this._saveChanges,thisArg:this}),this._sandbox.registerListener(this.TRANSITION_CREATED_EVENT,{callback:this._saveChanges,thisArg:this}),this._sandbox.registerListener(this.TRANSITION_EDITED_EVENT,{callback:this._saveChanges,thisArg:this}),this._sandbox.registerListener(this.TRANSITION_DELETED_EVENT,{callback:this._saveChanges,thisArg:this})),this.isRunning=!0)}onAppInit(){this._sandbox.unregisterListener(this.APP_INIT_EVENT,this.onAppInit)}saveCache(){localStorage.setItem("fsm-data",this._sandbox.sendMessage(this.SERIALIZE_FSM)),this._lastSave=Date.now()}loadCache(){let t=localStorage.getItem("fsm-data");t&&this._sandbox.sendMessage(this.DESERIALIZE_FSM,t)}clearCache(){localStorage.removeItem("fsm-data")}stop(){this.isRunning&&(this.isRunning=!1,this._autosaving&&(this._sandbox.unregisterListener(this.STATE_CREATED_EVENT,this._saveChanges),this._sandbox.unregisterListener(this.STATE_EDITED_EVENT,this._saveChanges),this._sandbox.unregisterListener(this.STATE_DELETED_EVENT,this._saveChanges),this._sandbox.unregisterListener(this.TRANSITION_CREATED_EVENT,this._saveChanges),this._sandbox.unregisterListener(this.TRANSITION_EDITED_EVENT,this._saveChanges),this._sandbox.unregisterListener(this.TRANSITION_DELETED_EVENT,this._saveChanges)),this._sandbox.unregisterMessageReceiver(this.SAVE_CACHE),this._sandbox.unregisterMessageReceiver(this.LOAD_CACHE),this._sandbox.unregisterMessageReceiver(this.CLEAR_CACHE))}cleanUp(){}_saveChanges(){if(!this._isWaiting){const t=Date.now()-this._lastSave;t>this._saveSpan?this.saveCache():(this._isWaiting=!0,setTimeout(()=>{this.saveCache(),this._isWaiting=!1},this._saveSpan-t))}}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return a}));var i=s(2),n=s(3);class a{constructor(t,e){this.SERIALIZE_FSM="fsm-serialize",this.DESERIALIZE_FSM="fsm-deserialize",this.ADD_ITEM="workspace-add-item",this.GET_ITEMS="workspace-get-items",this.isInit=!1,this.isRunning=!1,this._sandbox=t}init(){this.isInit||(this._sandbox.registerListener(this.APP_INIT_EVENT,{callback:this.onAppInit,thisArg:this}),this.isInit=!0)}start(){this.isRunning||(this._sandbox.registerMessageReceiver(this.SERIALIZE_FSM,this.serialize.bind(this)),this._sandbox.registerMessageReceiver(this.DESERIALIZE_FSM,this.deserialize.bind(this)),this.isRunning=!0)}onAppInit(){this._sandbox.unregisterListener(this.APP_INIT_EVENT,this.onAppInit)}serialize(){let t={},e=this._sandbox.sendMessage(this.GET_ITEMS,t=>t instanceof i.a),s=this._sandbox.sendMessage(this.GET_ITEMS,t=>t instanceof n.a),a=e.reduce((t,e,s)=>t.set(e,s),new Map);return t.states=e.map(t=>({id:a.get(t),pos:t.getPosition(),txt:t.getText(),acc:t.isAccepting,ent:t.isEntry})),t.transitions=s.map(t=>{let e={frm:a.get(t.firstItem),to:a.get(t.secondItem),con:t.getText()};if(t.isSelfLink()){let s=t._selfLinkDirection;e.dir={x:+s.x.toFixed(2),y:+s.y.toFixed(2)}}else t._sagitta&&(e.sag=Math.round(t._sagitta),e.rev=t._isReversed);return e}),JSON.stringify(t)}deserialize(t){let e=null;try{e=JSON.parse(t)}catch(t){console.log("Error parsing JSON data")}if(e){let t=[],s=[],a=new Map;if(e.states instanceof Array){let s=0,n=!1;e.states.forEach(e=>{if(e&&void 0!==e.id){let r=e.pos||{x:50,y:50},h=new i.a({text:void 0===e.txt?"S"+s++:e.txt,position:r,accept:e.acc,entry:!n&&e.ent});a.set(e.id,h),t.push(h),e.ent&&(n=!0)}})}e.transitions instanceof Array&&e.transitions.forEach(t=>{let e=a.get(t.frm),i=a.get(t.to);if(t&&void 0!==e&&void 0!==i){let a={first:e,second:i,text:t.con};e===i?a.selfLinkDirection=t.dir||{x:0,y:-1}:t.sag&&(a.sagitta=t.sag,a.reverse=t.rev),s.push(new n.a(a))}}),t.forEach(t=>this._sandbox.sendMessage(this.ADD_ITEM,t)),s.forEach(t=>this._sandbox.sendMessage(this.ADD_ITEM,t))}}stop(){this.isRunning&&(this.isRunning=!1,this._sandbox.unregisterMessageReceiver(this.SERIALIZE_FSM),this._sandbox.unregisterMessageReceiver(this.DESERIALIZE_FSM))}cleanUp(){}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return i}));class i{constructor(t,e){this.SHOW_POPUP="popup-show",this.HIDE_POPUP="popup-hide",this.ADD_KEY_LISTENER="add-key-listener",this.REMOVE_KEY_LISTENER="remove-key-listener",this.APP_INIT_EVENT="app-init",this.isInit=!1,this.isRunning=!1,this._sandbox=t,this._popup=this._createPopupContainer()}init(){this.isInit||(this._sandbox.registerListener(this.APP_INIT_EVENT,{callback:this.onAppInit,thisArg:this}),this.isInit=!0)}start(){this.isRunning||(this._sandbox.registerMessageReceiver(this.SHOW_POPUP,this.showPopup.bind(this)),this._sandbox.registerMessageReceiver(this.HIDE_POPUP,this.hidePopup.bind(this)),this.isRunning=!0)}onAppInit(){this._sandbox.unregisterListener(this.APP_INIT_EVENT,this.onAppInit)}showPopup(t){"none"!==this._popup.container.style.display&&this.hidePopup(),this._popup.container.style.display="flex";let e=(t=t||{}).focused||null;t.message&&(this._popup.text.innerText=t.message),t.input&&(t.input.forEach(t=>{let e=document.createElement("label");e.for=t.name,e.innerText=t.label,e.style.display="block",e.style["font-size"]="0.8em",this._popup.input.appendChild(e);let s=document.createElement("input");s.type="text",s.id=t.name,s.name=t.name,s.value=t.value||"",s.style.display="block",s.style.width="100%",s.style["margin-bottom"]="5px",s.addEventListener("input",t.onChange),this._popup.input.appendChild(s)}),e||(e=this._popup.input.getElementsByTagName("input")[0])),t.buttons&&(t.buttons.forEach(t=>{let e=document.createElement("button");e.innerText=t.text,e.style.padding="3px",e.style.display="inline-block",e.style.margin="3px",e.addEventListener("click",t.onClick),this._popup.buttons.appendChild(e)}),e||(e=this._popup.buttons.getElementsByTagName("button")[0])),"function"==typeof t.onEnter&&(this._popup.onEnter=t.onEnter,this._sandbox.sendMessage(this.ADD_KEY_LISTENER,{key:"Enter",listener:this._popup.onEnter})),"function"==typeof t.onEscape&&(this._popup.onEscape=t.onEscape,this._sandbox.sendMessage(this.ADD_KEY_LISTENER,{key:"Escape",listener:this._popup.onEscape})),e&&e.focus()}hidePopup(){"function"==typeof this._popup.onEnter&&(this._sandbox.sendMessage(this.REMOVE_KEY_LISTENER,{key:"Enter",listener:this._popup.onEnter}),this._popup.onEnter=null),"function"==typeof this._popup.onEscape&&(this._sandbox.sendMessage(this.REMOVE_KEY_LISTENER,{key:"Enter",listener:this._popup.onEscape}),this._popup.onEscape=null),this._popup.text.innerText="";let t=[],e=Array.prototype.slice.call(this._popup.input.getElementsByTagName("input"));return e&&e.forEach(e=>t.push({name:e.name,value:e.value})),this._removeChildren(this._popup.input),this._removeChildren(this._popup.buttons),this._popup.container.style.display="none",t}stop(){this.isRunning&&(this.isRunning=!1,this._sandbox.unregisterMessageReceiver(this.SHOW_POPUP),this._sandbox.unregisterMessageReceiver(this.HIDE_POPUP))}cleanUp(){}_removeChildren(t){Array.prototype.slice.call(t.childNodes).forEach(t=>t.parentNode.removeChild(t))}_createPopupContainer(){let t=document.createElement("div");t.style["background-color"]="rgba(0,0,0,0.7)",t.style.position="fixed",t.style.top=0,t.style.right=0,t.style.bottom=0,t.style.left=0,t.style.display="none",t.style["align-items"]="center",t.style["justify-content"]="center",t.style["z-index"]=99;let e=document.createElement("div");e.style.background="#FFFFFF",e.style["max-height"]="75%",e.style["max-width"]="75%",e.style.padding="10px",e.style["border-style"]="solid",e.style["border-width"]="1px",e.style["border-color"]="#333333",t.appendChild(e);let s=document.createElement("p");s.id="message",s.style["margin-bottom"]="8px",s.style["text-align"]="center",e.appendChild(s);let i=document.createElement("div");i.id="input",i.style["margin-bottom"]="8px",e.appendChild(i);let n=document.createElement("div");return n.id="buttons",n.style["text-align"]="center",e.appendChild(n),document.body.appendChild(t),{container:t,text:s,input:i,buttons:n}}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return a}));var i=s(2),n=s(3);class a{constructor(t){this.FORCE_RESCALE="workspace-force-rescale",this.SAVE_CACHE="fsm-save-cache",this.LOAD_CACHE="fsm-load-cache",this.CLEAR_CACHE="fsm-clear-cache",this.SELECT_ITEM="workspace-select-item",this.GET_ITEMS="workspace-get-items",this.REMOVE_ITEM="workspace-remove-item",this.SERIALIZE_FSM="fsm-serialize",this.DESERIALIZE_FSM="fsm-deserialize",this.REFRESH_WORKSPACE="workspace-refresh",this.SHOW_POPUP="popup-show",this.HIDE_POPUP="popup-hide",this.ADD_BUTTON_LISTENER="add-button-listener",this.REMOVE_BUTTON_LISTENER="remove-button-listener",this.APP_INIT_EVENT="app-init",this.isInit=!1,this.isRunning=!1,this._sandbox=t,this._onNew=()=>{this.isRunning&&this._onNewClicked()},this._onSave=()=>{this.isRunning&&this._onSaveClicked()},this._onLoad=()=>{this.isRunning&&this._onLoadClicked()},this._onRun=()=>{this.isRunning&&this._onRunClicked()},this._onEdit=()=>{this.isRunning&&this._onEditClicked()}}init(){this.isInit||(this._sandbox.registerListener(this.APP_INIT_EVENT,{callback:this.onAppInit,thisArg:this}),this.isInit=!0)}start(){this.isRunning||(this.isRunning=!0)}onAppInit(){this._sandbox.unregisterListener(this.APP_INIT_EVENT,this.onAppInit),this._sandbox.sendMessage(this.ADD_BUTTON_LISTENER,{id:"new",listener:this._onNew}),this._sandbox.sendMessage(this.ADD_BUTTON_LISTENER,{id:"save",listener:this._onSave}),this._sandbox.sendMessage(this.ADD_BUTTON_LISTENER,{id:"load",listener:this._onLoad}),this._sandbox.sendMessage(this.ADD_BUTTON_LISTENER,{id:"run",listener:this._onRun}),this._sandbox.sendMessage(this.ADD_BUTTON_LISTENER,{id:"design",listener:this._onEdit}),this._loadSimulator()}stop(){this.isRunning&&(this.isRunning=!1,this._sandbox.unregisterListener(this.STATE_CREATED_EVENT,this._saveChanges),this._sandbox.unregisterListener(this.STATE_EDITED_EVENT,this._saveChanges),this._sandbox.unregisterListener(this.STATE_DELETED_EVENT,this._saveChanges),this._sandbox.unregisterListener(this.TRANSITION_CREATED_EVENT,this._saveChanges),this._sandbox.unregisterListener(this.TRANSITION_EDITED_EVENT,this._saveChanges),this._sandbox.unregisterListener(this.TRANSITION_DELETED_EVENT,this._saveChanges),this._sandbox.unregisterMessageReceiver(this.CLEAR_CACHE))}cleanUp(){this._sandbox.sendMessage(this.REMOVE_BUTTON_LISTENER,{id:"new",listener:this._onNew}),this._sandbox.sendMessage(this.REMOVE_BUTTON_LISTENER,{id:"save",listener:this._onSave}),this._sandbox.sendMessage(this.REMOVE_BUTTON_LISTENER,{id:"load",listener:this._onLoad}),this._sandbox.sendMessage(this.REMOVE_BUTTON_LISTENER,{id:"run",listener:this._onRun}),this._sandbox.sendMessage(this.REMOVE_BUTTON_LISTENER,{id:"design",listener:this._onEdit})}_clearDesigner(){this._sandbox.sendMessage(this.GET_ITEMS,t=>t instanceof n.a||t instanceof i.a).forEach(t=>{this._sandbox.sendMessage(this.REMOVE_ITEM,t)}),this._sandbox.sendMessage(this.CLEAR_CACHE),this._sandbox.sendMessage(this.REFRESH_WORKSPACE)}_onNewClicked(){this._unfocusWorkspace();let t=()=>this._sandbox.sendMessage(this.HIDE_POPUP);this._sandbox.sendMessage(this.SHOW_POPUP,{message:"This will delete all unsaved progress.\nAre you sure?",buttons:[{text:"Confirm",onClick:()=>{this._sandbox.sendMessage(this.HIDE_POPUP),this._clearDesigner(),window.location.href.toLowerCase().includes("/app/designer")||(window.location.href="/App/Designer")}},{text:"Cancel",onClick:t}],onEscape:t})}_onSaveClicked(){this._unfocusWorkspace();let t=()=>this._sandbox.sendMessage(this.HIDE_POPUP);this._sandbox.sendMessage(this.SHOW_POPUP,{message:"Please choose saving method",buttons:[{text:"Image",onClick:()=>this._saveOnline()},{text:"Local File",onClick:()=>this._saveOnline()},{text:"Generate URL",onClick:()=>this._saveOnline()},{text:"Cancel",onClick:t}],onEscape:t})}_onLoadClicked(){}_onRunClicked(){this._sandbox.sendMessage(this.SAVE_CACHE),window.location.href="/App/Simulator"}_onEditClicked(){window.location.href="/App/Designer"}_loadSimulator(){if(/Simulator\/\S{24}$/.test(window.location.pathname)){this._sandbox.sendMessage(this.SHOW_POPUP,{message:"Loading... Please wait"});const t=new XMLHttpRequest,e=window.location.pathname.split("/"),s=window.location.origin+"/api/fsm/"+e[e.length-1];t.open("GET",s,!0),t.setRequestHeader("Content-Type","application/json"),t.onreadystatechange=()=>{4===t.readyState&&(200===t.status&&(this._sandbox.sendMessage(this.DESERIALIZE_FSM,t.responseText),this._sandbox.sendMessage(this.FORCE_RESCALE),this._sandbox.sendMessage(this.SAVE_CACHE)),this._sandbox.sendMessage(this.HIDE_POPUP))},t.send()}else this._sandbox.sendMessage(this.LOAD_CACHE)}_saveOnline(){let t=()=>this._sandbox.sendMessage(this.HIDE_POPUP);this._sandbox.sendMessage(this.SHOW_POPUP,{message:"Saving... Please wait",buttons:[{text:"No, thanks",onClick:t}],onEscape:t});const e=new XMLHttpRequest,s=window.location.origin+"/api/fsm";e.open("POST",s,!0),e.setRequestHeader("Content-Type","application/json"),e.onreadystatechange=()=>{if(4===e.readyState){let t=()=>this._sandbox.sendMessage(this.HIDE_POPUP),s="Something went wrong...",i=[{text:"OK",onClick:t}],n=[];201===e.status&&(s="Saving succesful!",i.push({text:"Go to",onClick:()=>window.open(e.getResponseHeader("Location"),"_blank")}),n.push({name:"fsm-url",label:"URL",value:e.getResponseHeader("Location")})),this._sandbox.sendMessage(this.SHOW_POPUP,{message:s,buttons:i,input:n,onEscape:t})}};var i=this._sandbox.sendMessage(this.SERIALIZE_FSM);e.send(i)}_unfocusWorkspace(){this._sandbox.handshake(this.SELECT_ITEM)&&this._sandbox.sendMessage(this.SELECT_ITEM,{item:null})}}},function(t,e,s){"use strict";var i=s(0);class n{constructor(t,e,s){this._name=t,this._methods=e||[],this._properties=s||[];for(let t=0,s=e.length;t<s;t++){if("string"!=typeof e[t])throw new Error("To define an interface you need to provide list of method names of type string");this._methods.push(e[t])}for(let t=0,e=s.length;t<e;t++){if("string"!=typeof s[t])throw new Error("To define an interface you need to provide list of property names of type string");this._properties.push(s[t])}}isImplemtedBy(t){if("object"!=typeof t)throw new Error("The "+this._name+" interface is not implemented by "+typeof t);for(let e=0,s=this._methods.length;e<s;e++){let s=this._methods[e];if(void 0===t[s]||"function"!=typeof t[s])throw new Error("Object does not implement the interface "+this._name+". Missing method: "+s)}for(let e=0,s=this._properties.length;e<s;e++){let s=this._properties[e];if(void 0===t[s]||"function"==typeof t[s])throw new Error("Object does not implement the interface "+this._name+". Missing properties: "+s)}}}class a{constructor(){this._listeners=[]}registerListener(t){if(!t||!t.callback||"function"!=typeof t.callback)throw new Error("Event listener has to be of type function");this._listeners.find(e=>e.callback===t.callback)||this._listeners.push(t)}unregisterListener(t){return i.a.remove(this._listeners.find(e=>e.callback===t),this._listeners)}clear(){this._listeners=[]}invoke(t){const e=this._listeners.slice();for(let s=0,i=e.length;s<i;s++){const i=e[s];i.thisArg?i.callback.call(i.thisArg,t):i.callback(t)}}}class r{constructor(){this.EVENT_REGISTERED_EVENT="event-registered",this.EVENT_UNREGISTERED_EVENT="event-unregistered",this._events=new Map,this._events.set(this.EVENT_REGISTERED_EVENT,new a),this._events.set(this.EVENT_UNREGISTERED_EVENT,new a),this._queue=[],this._executing=!1}create(t){this._events.has(t)||(this._events.set(t,new a),this.raise(this.EVENT_REGISTERED_EVENT,t))}delete(t){let e=!1,s=this._events;return s.has(t)&&(s.delete(t),this.raise(this.EVENT_UNREGISTERED_EVENT,t),e=!0),e}raise(t,e){let s=!1,i=this._events.get(t);if(i){if(this._executing)this._queue.push({eventName:t,args:e});else if(this._executing=!0,i.invoke(e),this._executing=!1,this._queue.length>0){let t=this._queue.shift();this.raise(t.eventName,t.args)}s=!0}return s}registerListener(t,e){let s=!1,i=this._events.get(t);return i&&(i.registerListener(e),s=!0),s}unregisterListener(t,e){let s=!1,i=this._events.get(t);return i&&(s=i.unregisterListener(e)),s}}class h{constructor(){this._receivers=new Map}register(t,e){let s=this._receivers;if(s.has(t))throw new Error("Receiver "+t+" already registered");if(!e||"function"!=typeof e)throw new Error("Receiver must be a function");s.set(t,e)}unregister(t){let e=!1,s=this._receivers;return s.has(t)&&(s.delete(t),e=!0),e}send(t,e){let s=this._receivers;if(!s.has(t))throw new Error("Receiver "+t+" not registered");return s.get(t)(e)}handshake(t){return this._receivers.has(t)}}class o{constructor(){this._modules=new Map}add(t,e){this._modules.set(e,t)}init(t){let e=!1,s=this._modules.get(t);return s&&(s.isInit||s.init(),e=!0),e}initAll(){for(let t of this._modules.values())t.isInit||t.init()}startAll(){for(let t of this._modules.values())t.isRunning||t.start()}start(t){let e=!1,s=this._modules.get(t);return s&&(s.isRunning||s.start(),e=!0),e}stopAll(){for(let t of this._modules.values())t.isRunning&&t.stop()}stop(t){let e=!1,s=this._modules.get(t);return s&&(s.isRunning&&s.stop(),e=!0),e}remove(t){let e=!1,s=this._modules;return s.has(t)&&(this.stop(t),s.get(t).cleanUp(),s.delete(t),e=!0),e}}class _{constructor(){this._interfaces=new Map}declare(t,e,s){this._interfaces.set(t,new n(t,e,s))}assert(t,e){const s=this._interfaces.get(e);if(!s)throw new Error("Interface "+e+" is not declared");s.isImplemtedBy(t)}}class E{constructor(t){this._core=t}registerMessageReceiver(t,e){this._core.registerMessageReceiver(t,e)}unregisterMessageReceiver(t){return this._core.unregisterMessageReceiver(t)}sendMessage(t,e){return this._core.sendMessage(t,e)}handshake(t){return this._core.handshake(t)}createEvent(t){this._core.createEvent(t)}deleteEvent(t){return this._core.deleteEvent(t)}raiseEvent(t,e){return this._core.raiseEvent(t,e)}registerListener(t,e){this._core.registerListener(t,e)}unregisterListener(t,e){return this._core.unregisterListener(t,e)}declareInterface(t,e,s){this._core.declareInterface(t,e,s)}assertInterface(t,e){this._core.assertInterface(t,e)}}s.d(e,"a",(function(){return d}));class d{constructor(){this.APP_INIT_EVENT="app-init",this.MODULE_INTERFACE="module",this._isInit=!1,this._sandbox=new E(this),this._mediator=new h,this._modulesManager=new o,this._eventsManager=new r,this._interfacesManager=new _,this.createEvent(this.APP_INIT_EVENT),this.declareInterface(this.MODULE_INTERFACE,["init","start","stop","cleanUp"],["isInit","isRunning"])}init(){this._isInit||(this._modulesManager.initAll(),this._modulesManager.startAll(),this._isInit=!0,this.raiseEvent(this.APP_INIT_EVENT))}addModule(t,e,s){if(this._isInit)throw new Error("Cannot add modules when the app is initialised");const i=new t(this._sandbox,s);this.assertInterface(i,this.MODULE_INTERFACE),this._modulesManager.add(i,e)}startModule(t){return this._modulesManager.start(t)}stopModule(t){return this._modulesManager.stop(t)}removeModule(t){return this._modulesManager.remove(t)}registerMessageReceiver(t,e){this._mediator.register(t,e)}unregisterMessageReceiver(t){return this._mediator.unregister(t)}sendMessage(t,e){return this._mediator.send(t,e)}handshake(t){return this._mediator.handshake(t)}createEvent(t){this._eventsManager.create(t)}deleteEvent(t){return this._eventsManager.delete(t)}raiseEvent(t,e){return this._eventsManager.raise(t,e)}registerListener(t,e){this._eventsManager.registerListener(t,e)}unregisterListener(t,e){return this._eventsManager.unregisterListener(t,e)}declareInterface(t,e,s){this._interfacesManager.declare(t,e,s)}assertInterface(t,e){this._interfacesManager.assert(t,e)}}},function(t,e,s){"use strict";s.r(e);var i=s(13),n=s(5),a=s(6),r=s(7),h=s(8);class o{constructor(t,e){this.ADD_ITEM="workspace-add-item",this.MOVE_ITEM="workspace-move-item",this.REMOVE_ITEM="workspace-remove-item",this.APP_INIT_EVENT="app-init",this.ITEM_MOVED_EVENT="workspace-item-moved",this.isInit=!1,this.isRunning=!1,this._sandbox=t,e=e||{},this._distance=void 0===e.distance?50:e.distance,this._reach=void 0===e.reach?5:e.reach,this._isVisible=e.visibility}init(){this.isInit||(this._sandbox.registerListener(this.APP_INIT_EVENT,{callback:this.onAppInit,thisArg:this}),this.isInit=!0)}start(){this.isRunning||(this._sandbox.registerListener(this.ITEM_MOVED_EVENT,{callback:this.onItemMoved,thisArg:this}),this.isRunning=!0)}onAppInit(){this._sandbox.unregisterListener(this.APP_INIT_EVENT,this.onAppInit),this._isVisible&&this._sandbox.sendMessage(this.ADD_ITEM,this)}draw(t){if(this.isRunning){let e=t.canvas,s={name:"height",value:e.height},i={name:"width",value:e.width};if(e.width<e.height){let t=s;s=i,i=t}t.save(),t.strokeStyle="#ebebeb",t.beginPath();let n=this._distance;for(;n<s.value;n+=this._distance)t.moveTo(0,n),t.lineTo(e.width,n),t.moveTo(n,0),t.lineTo(n,e.height);for(;n<i.value;n+=this._distance)(i.name="width")?(t.moveTo(n,0),t.lineTo(n,e.height)):(t.moveTo(0,n),t.lineTo(e.width,n));t.stroke(),t.restore()}}onItemMoved(t){if(t.item.isPullable){let e=this._pull(t.item.getBounds(),t.point.x,t.point.y);t.source===this||e.x===t.point.x&&e.y===t.point.y||this._sandbox.sendMessage(this.MOVE_ITEM,{item:t.item,point:e,sender:this})}}stop(){this.isRunning&&(this._sandbox.unregisterListener(this.ITEM_MOVED_EVENT,this.onItemMoved),this.isRunning=!1)}cleanUp(){this._isVisible&&this._sandbox.sendMessage(this.REMOVE_ITEM,this)}_pull(t,e,s){return{x:this._computePosition(e,t.left,t.right),y:this._computePosition(s,t.bottom,t.top)}}_computePosition(t,e,s){let i=this._nearestRuler(t,e,s);return i.distance<=this._reach?i.position:t}_nearestRuler(t,e,s){let i=e%this._distance,n=this._distance-s%this._distance,a={};return i<=n?(a.distance=i,a.position=t-i):(a.distance=n,a.position=t+n),a}}var _=s(9),E=s(10);class d{constructor(t){this.MOVE_ITEM="workspace-move-item",this.BEGIN_DRAG="workspace-begin-drag",this.END_DRAG="workspace-end-drag",this.IS_DRAGGING="workspace-is-dragging",this.ITEM_DRAG_STARTED_EVENT="workspace-drag-started",this.ITEM_DRAG_ENDED_EVENT="workspace-drag-ended",this.ITEM_MOVED_EVENT="workspace-item-moved",this.GET_ITEM_AT="workspace-get-item",this.REFRESH_WORKSPACE="workspace-refresh",this.PREVENT_SCROLLING="prevent-scrolling",this.POINTER_DOWN_EVENT="pointer-down",this.POINTER_MOVE_EVENT="pointer-move",this.POINTER_UP_EVENT="pointer-up",this.isInit=!1,this.isRunning=!1,this._sandbox=t,this._draggedItem=null,this._dragStart=null}init(){this.isInit||(this._sandbox.registerListener(this.APP_INIT_EVENT,{callback:this.onAppInit,thisArg:this}),this._sandbox.createEvent(this.ITEM_DRAG_STARTED_EVENT),this._sandbox.createEvent(this.ITEM_MOVED_EVENT),this._sandbox.createEvent(this.ITEM_DRAG_ENDED_EVENT),this.isInit=!0)}start(){this.isRunning||(this._sandbox.registerListener(this.POINTER_DOWN_EVENT,{callback:this._handlePointerDown,thisArg:this}),this._sandbox.registerListener(this.POINTER_MOVE_EVENT,{callback:this._handlePointerMove,thisArg:this}),this._sandbox.registerListener(this.POINTER_UP_EVENT,{callback:this._handlePointerUp,thisArg:this}),this._sandbox.registerMessageReceiver(this.MOVE_ITEM,this.moveItem.bind(this)),this._sandbox.registerMessageReceiver(this.BEGIN_DRAG,this.beginDrag.bind(this)),this._sandbox.registerMessageReceiver(this.END_DRAG,this.endDrag.bind(this)),this._sandbox.registerMessageReceiver(this.IS_DRAGGING,()=>!!this._draggedItem),this.isRunning=!0)}onAppInit(){this._sandbox.unregisterListener(this.APP_INIT_EVENT,this.onAppInit)}beginDrag(t){let e=t.item,s=t.point;this.endDrag(s),e&&e.isMovable&&(this._draggedItem=e,this._dragStart=e.getPosition(),this._sandbox.raiseEvent(this.ITEM_DRAG_STARTED_EVENT,{item:e,point:s}),this._sandbox.sendMessage(this.PREVENT_SCROLLING,!1))}endDrag(t){if(this._draggedItem){let e=this._draggedItem;this._draggedItem=null,this._sandbox.raiseEvent(this.ITEM_DRAG_ENDED_EVENT,{item:e,point:t,from:this._dragStart,to:e.getPosition()}),this._dragStart=null,this._sandbox.sendMessage(this.PREVENT_SCROLLING,!0)}}moveItem(t){let e=t.item,s=t.point;e&&e.isMovable&&(e.move(s),this._sandbox.sendMessage(this.REFRESH_WORKSPACE,!1),this._sandbox.raiseEvent(this.ITEM_MOVED_EVENT,{item:e,point:s,source:t.sender}))}stop(){this.isRunning&&(this._sandbox.unregisterMessageReceiver(this.MOVE_ITEM),this._sandbox.unregisterMessageReceiver(this.BEGIN_DRAG),this._sandbox.unregisterMessageReceiver(this.END_DRAG),this._sandbox.unregisterMessageReceiver(this.IS_DRAGGING),this._sandbox.unregisterListener(this.POINTER_DOWN_EVENT,this._handlePointerDown),this._sandbox.unregisterListener(this.POINTER_MOVE_EVENT,this._handlePointerMove),this._sandbox.unregisterListener(this.POINTER_UP_EVENT,this._handlePointerUp),this.isRunning=!1)}cleanUp(){this._sandbox.deleteEvent(this.ITEM_DRAG_STARTED_EVENT),this._sandbox.deleteEvent(this.ITEM_DRAG_ENDED_EVENT),this._sandbox.deleteEvent(this.ITEM_MOVED_EVENT)}_handlePointerDown(t){let e={x:t.x,y:t.y},s=this._sandbox.sendMessage(this.GET_ITEM_AT,{point:e,predicate:t=>t.isMovable});this.beginDrag({item:s,point:e})}_handlePointerMove(t){this._draggedItem&&this.moveItem({item:this._draggedItem,point:{x:t.x,y:t.y}})}_handlePointerUp(t){this.endDrag({x:t.x,y:t.y})}}class l{constructor(t){this.SELECT_ITEM="workspace-select-item",this.GET_SELECTED_ITEM="workspace-get-selection",this.ITEM_PRESSED_EVENT="workspace-item-pressed",this.ITEM_POINTER_OVER_CHANGED_EVENT="workspace-item-pointer-over-changed",this.ITEM_SELECTION_CHANGED_EVENT="workspace-item-selection-changed",this.GET_ITEM_AT="workspace-get-item",this.IS_DRAGGING="workspace-is-dragging",this.REFRESH_WORKSPACE="workspace-refresh",this.APP_INIT_EVENT="app-init",this.POINTER_DOWN_EVENT="pointer-down",this.POINTER_MOVE_EVENT="pointer-move",this.POINTER_UP_EVENT="pointer-up",this.isInit=!1,this.isRunning=!1,this._sandbox=t}init(){this.isInit||(this._sandbox.registerListener(this.APP_INIT_EVENT,{callback:this.onAppInit,thisArg:this}),this._sandbox.createEvent(this.ITEM_PRESSED_EVENT),this._sandbox.createEvent(this.ITEM_POINTER_OVER_CHANGED_EVENT),this._sandbox.createEvent(this.ITEM_SELECTION_CHANGED_EVENT),this.isInit=!0)}start(){this.isRunning||(this._sandbox.registerListener(this.POINTER_DOWN_EVENT,{callback:this._handlePointerDown,thisArg:this}),this._sandbox.registerListener(this.POINTER_MOVE_EVENT,{callback:this._handlePointerMove,thisArg:this}),this._sandbox.registerListener(this.POINTER_UP_EVENT,{callback:this._handlePointerUp,thisArg:this}),this._sandbox.registerMessageReceiver(this.SELECT_ITEM,this.selectItem.bind(this)),this._sandbox.registerMessageReceiver(this.GET_SELECTED_ITEM,()=>this._selectedItem),this.isRunning=!0)}onAppInit(){this._sandbox.unregisterListener(this.APP_INIT_EVENT,this.onAppInit),this.selectItem({item:null})}hoverItem(t,e){let s=this._hoveredItem,i=t&&t.isHoverable?t:null;this._hoveredItem=i;let n=!1;s&&(s.pointerOut(),n=!0),i&&(i.pointerOver(),n=!0),n&&this._sandbox.sendMessage(this.REFRESH_WORKSPACE),this._sandbox.raiseEvent(this.ITEM_POINTER_OVER_CHANGED_EVENT,{point:e,oldItem:s,newItem:i})}selectItem(t){let e=t.item,s=t.point,i=this._selectedItem,n=e&&e.isSelectable?e:null;this._selectedItem=n;let a=!1;i&&(i.unselect(),a=!0),n&&(n.select(s),a=!0),a&&this._sandbox.sendMessage(this.REFRESH_WORKSPACE),this._sandbox.raiseEvent(this.ITEM_SELECTION_CHANGED_EVENT,{point:s,oldItem:i,newItem:n})}stop(){this.isRunning&&(this._sandbox.unregisterMessageReceiver(this.SELECT_ITEM),this._sandbox.unregisterMessageReceiver(this.GET_SELECTED_ITEM),this._sandbox.unregisterListener(this.POINTER_DOWN_EVENT,this._handlePointerDown),this._sandbox.unregisterListener(this.POINTER_MOVE_EVENT,this._handlePointerMove),this._sandbox.unregisterListener(this.POINTER_UP_EVENT,this._handlePointerUp),this.isRunning=!1)}cleanUp(){this._sandbox.deleteEvent(this.ITEM_PRESSED_EVENT),this._sandbox.deleteEvent(this.ITEM_POINTER_OVER_CHANGED_EVENT),this._sandbox.deleteEvent(this.ITEM_SELECTION_CHANGED_EVENT)}_handlePointerDown(t){let e={x:t.x,y:t.y},s=this._sandbox.sendMessage(this.GET_ITEM_AT,{point:e,predicate:t=>t.isSelectable});this.selectItem({item:s,point:e})}_handlePointerMove(t){let e={x:t.x,y:t.y};if(!this._sandbox.sendMessage(this.IS_DRAGGING)){let t=this._sandbox.sendMessage(this.GET_ITEM_AT,{point:e,predicate:t=>t.isHoverable});(this._hoveredItem||t)&&this.hoverItem(t,e)}}_handlePointerUp(t){let e={x:t.x,y:t.y},s=this._sandbox.sendMessage(this.GET_ITEM_AT,{point:e,predicate:t=>t.isSelectable});this._selectedItem&&s===this._selectedItem&&this._sandbox.raiseEvent(this.ITEM_PRESSED_EVENT,{point:e,item:s,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey})}}var c=s(11),T=s(0),g=s(2);class u{constructor(t){this.STATE_CREATED_EVENT="fsm-state-created",this.STATE_EDITED_EVENT="fsm-state-edited",this.STATE_DELETED_EVENT="fsm-state-edited",this.ADD_ITEM="workspace-add-item",this.SELECT_ITEM="workspace-select-item",this.GET_SELECTED_ITEM="workspace-get-selection",this.GET_ITEM_AT="workspace-get-item",this.GET_ITEMS="workspace-get-items",this.REFRESH_WORKSPACE="workspace-refresh",this.SHOW_POPUP="popup-show",this.HIDE_POPUP="popup-hide",this.SET_CONTROL_DISABLED="disable-control",this.ADD_KEY_LISTENER="add-key-listener",this.REMOVE_KEY_LISTENER="remove-key-listener",this.ADD_BUTTON_LISTENER="add-button-listener",this.REMOVE_BUTTON_LISTENER="remove-button-listener",this.APP_INIT_EVENT="app-init",this.ITEM_PRESSED_EVENT="workspace-item-pressed",this.ITEM_DELETED_EVENT="workspace-item-deleted",this.ITEM_DRAG_ENDED_EVENT="workspace-drag-ended",this.ITEM_SELECTION_CHANGED_EVENT="workspace-item-selection-changed",this.DOUBLE_CLICK_EVENT="double-click",this.isInit=!1,this.isRunning=!1,this._sandbox=t,this._nextNum=0,this._onAdd=()=>{this.isRunning&&this.addState()},this._onAccept=()=>{this.isRunning&&this._operateOnSelectedState(t=>this.makeAccepting(t))},this._onInitial=()=>{this.isRunning&&this._operateOnSelectedState(t=>this.changeEntryPoint({item:t}))},this._onEdit=()=>{this.isRunning&&this._operateOnSelectedState(t=>this.beginEditState(t))}}init(){this.isInit||(this._sandbox.registerListener(this.APP_INIT_EVENT,{callback:this.onAppInit,thisArg:this}),this._sandbox.createEvent(this.STATE_CREATED_EVENT),this._sandbox.createEvent(this.STATE_EDITED_EVENT),this._sandbox.createEvent(this.STATE_DELETED_EVENT),this.isInit=!0)}start(){this.isRunning||(this._sandbox.registerListener(this.ITEM_PRESSED_EVENT,{callback:this._onItemPressed,thisArg:this}),this._sandbox.registerListener(this.ITEM_DELETED_EVENT,{callback:this._onItemDeleted,thisArg:this}),this._sandbox.registerListener(this.DOUBLE_CLICK_EVENT,{callback:this._onPointerDoubleClicked,thisArg:this}),this._sandbox.registerListener(this.ITEM_DRAG_ENDED_EVENT,{callback:this._onItemDragged,thisArg:this}),this._sandbox.registerListener(this.ITEM_SELECTION_CHANGED_EVENT,{callback:this._onItemSelectionChanged,thisArg:this}),this.isRunning=!0)}onAppInit(){this._sandbox.unregisterListener(this.APP_INIT_EVENT,this.onAppInit),this._sandbox.sendMessage(this.ADD_KEY_LISTENER,{key:"Enter",listener:this._onEdit}),this._sandbox.sendMessage(this.ADD_BUTTON_LISTENER,{id:"accept",listener:this._onAccept}),this._sandbox.sendMessage(this.ADD_BUTTON_LISTENER,{id:"add",listener:this._onAdd}),this._sandbox.sendMessage(this.ADD_BUTTON_LISTENER,{id:"connect",listener:this._onConnect}),this._sandbox.sendMessage(this.ADD_BUTTON_LISTENER,{id:"initial",listener:this._onInitial}),this._sandbox.sendMessage(this.ADD_BUTTON_LISTENER,{id:"edit",listener:this._onEdit}),this._reloadNumbering()}addState(t){t=t||{x:50,y:50};let e=new g.a({text:"S"+this._nextNum++,position:t});this._sandbox.sendMessage(this.ADD_ITEM,e),this.changeEntryPoint({item:e,abortIfExists:!0}),this._sandbox.sendMessage(this.SELECT_ITEM,{item:e,point:t}),this._sandbox.raiseEvent(this.STATE_CREATED_EVENT,e)}beginEditState(t){this._sandbox.sendMessage(this.REMOVE_KEY_LISTENER,{key:"Enter",listener:this._onEdit});let e=()=>{let e=this._sandbox.sendMessage(this.HIDE_POPUP).find(t=>"state-name"===t.name).value;this.endEditState(t,e)},s=()=>{this._sandbox.sendMessage(this.HIDE_POPUP),this.endEditState(t)};this._sandbox.sendMessage(this.SHOW_POPUP,{message:"Please enter new name for the state",input:[{name:"state-name",label:"State name"}],buttons:[{text:"Save",onClick:e},{text:"Cancel",onClick:s}],onEscape:s,onEnter:e})}endEditState(t,e){if(void 0!==e){const s=t.getText();t.setText(e),this._processNewName(e),this._sandbox.raiseEvent(this.STATE_EDITED_EVENT,{state:t,changes:[{name:"text",oldValue:s}]}),this._sandbox.sendMessage(this.REFRESH_WORKSPACE)}this._sandbox.sendMessage(this.ADD_KEY_LISTENER,{key:"Enter",listener:this._onEdit})}makeAccepting(t){t.accept(!t.isAccepting),this._sandbox.raiseEvent(this.STATE_EDITED_EVENT,{state:t,changes:[{name:"isAccepting",oldValue:!t.isAccepting}]}),this._sandbox.sendMessage(this.REFRESH_WORKSPACE)}changeEntryPoint(t){let e=this._sandbox.sendMessage(this.GET_ITEMS).find(t=>t instanceof g.a&&!0===t.isEntry);!t.abortIfExists&&e?(e.setAsEntry(!1),this._sandbox.raiseEvent(this.STATE_EDITED_EVENT,{state:e,changes:[{name:"isEntry",oldValue:!0}]}),t.item.setAsEntry(!0),this._sandbox.raiseEvent(this.STATE_EDITED_EVENT,{state:t.item,changes:[{name:"isEntry",oldValue:!1}]}),this._sandbox.sendMessage(this.REFRESH_WORKSPACE)):e||(t.item.setAsEntry(!0),this._sandbox.raiseEvent(this.STATE_EDITED_EVENT,{state:t.item,changes:[{name:"isEntry",oldValue:!1}]}),this._sandbox.sendMessage(this.REFRESH_WORKSPACE))}stop(){this.isRunning&&(this.isRunning=!1,this._sandbox.unregisterListener(this.ITEM_PRESSED_EVENT,this._onItemPressed),this._sandbox.unregisterListener(this.ITEM_DELETED_EVENT,this._onItemDeleted),this._sandbox.unregisterListener(this.DOUBLE_CLICK_EVENT,this._onPointerDoubleClicked),this._sandbox.unregisterListener(this.ITEM_DRAG_ENDED_EVENT,this._onItemDragged),this._sandbox.unregisterListener(this.ITEM_SELECTION_CHANGED_EVENT,this._onItemSelectionChanged))}cleanUp(){this._sandbox.deleteEvent(this.STATE_CREATED_EVENT),this._sandbox.deleteEvent(this.STATE_EDITED_EVENT),this._sandbox.deleteEvent(this.STATE_DELETED_EVENT),this._sandbox.sendMessage(this.REMOVE_KEY_LISTENER,{key:"Enter",listener:this._onEdit}),this._sandbox.sendMessage(this.REMOVE_BUTTON_LISTENER,{id:"accept",listener:this._onAccept}),this._sandbox.sendMessage(this.REMOVE_BUTTON_LISTENER,{id:"add",listener:this._onAdd}),this._sandbox.sendMessage(this.REMOVE_BUTTON_LISTENER,{id:"connect",listener:this._onConnect}),this._sandbox.sendMessage(this.REMOVE_BUTTON_LISTENER,{id:"initial",listener:this._onInitial}),this._sandbox.sendMessage(this.REMOVE_BUTTON_LISTENER,{id:"edit",listener:this._onEdit}),this._sandbox.sendMessage(this.REMOVE_BUTTON_LISTENER,{id:"new",listener:this._onNew})}_reloadNumbering(){this._nextNum=0,this._sandbox.sendMessage(this.GET_ITEMS,t=>t instanceof g.a).forEach(t=>this._processNewName(t.getText()))}_processNewName(t){if(t&&/^S\d+$/.test(t)){const e=parseInt(t.substring(1));e>this._nextNum&&(this._nextNum=e+1)}}_operateOnSelectedState(t){let e=this._sandbox.sendMessage(this.GET_SELECTED_ITEM);if(e&&e instanceof g.a)return t(e)}_onItemPressed(t){t.item instanceof g.a&&t.shiftKey&&this.changeEntryPoint({item:t.item})}_onItemDeleted(t){if(t.item instanceof g.a){if(this._sandbox.raiseEvent(this.STATE_DELETED_EVENT,t.item),t.item.isEntry){let t=this._sandbox.sendMessage(this.GET_ITEMS,t=>t instanceof g.a);t&&t.length>0&&this.changeEntryPoint({item:t[0]})}this._reloadNumbering()}}_onItemDragged(t){t.item instanceof g.a&&!T.b.arePointsEqual(t.from,t.to)&&this._sandbox.raiseEvent(this.STATE_EDITED_EVENT,{state:t.item,changes:[{name:"position",oldValue:t.from}]})}_onPointerDoubleClicked(t){let e={x:t.x,y:t.y},s=this._sandbox.sendMessage(this.GET_ITEM_AT,{point:e,predicate:function(t){return t instanceof g.a}});s?this.makeAccepting(s):this.addState(e)}_onItemSelectionChanged(t){t.newItem instanceof g.a?(this._sandbox.sendMessage(this.SET_CONTROL_DISABLED,{id:"connect",disabled:!1}),this._sandbox.sendMessage(this.SET_CONTROL_DISABLED,{id:"accept",disabled:!1}),this._sandbox.sendMessage(this.SET_CONTROL_DISABLED,{id:"initial",disabled:!1}),this._sandbox.sendMessage(this.SET_CONTROL_DISABLED,{id:"edit",disabled:!1}),this._sandbox.sendMessage(this.SET_CONTROL_DISABLED,{id:"delete",disabled:!1})):t.newItem||(this._sandbox.sendMessage(this.SET_CONTROL_DISABLED,{id:"connect",disabled:!0}),this._sandbox.sendMessage(this.SET_CONTROL_DISABLED,{id:"accept",disabled:!0}),this._sandbox.sendMessage(this.SET_CONTROL_DISABLED,{id:"initial",disabled:!0}),this._sandbox.sendMessage(this.SET_CONTROL_DISABLED,{id:"edit",disabled:!0}),this._sandbox.sendMessage(this.SET_CONTROL_DISABLED,{id:"delete",disabled:!0}))}}var p=s(3);class I{constructor(t){this.TRANSITION_CREATED_EVENT="fsm-transition-created",this.TRANSITION_EDITED_EVENT="fsm-transition-edited",this.TRANSITION_DELETED_EVENT="fsm-transition-edited",this.ADD_ITEM="workspace-add-item",this.REMOVE_ITEM="workspace-remove-item",this.BEGIN_DRAG="workspace-begin-drag",this.GET_SELECTED_ITEM="workspace-get-selection",this.GET_ITEM_AT="workspace-get-item",this.GET_ITEMS="workspace-get-items",this.SHOW_POPUP="popup-show",this.HIDE_POPUP="popup-hide",this.SET_CONTROL_DISABLED="disable-control",this.REFRESH_WORKSPACE="workspace-refresh",this.ADD_KEY_LISTENER="add-key-listener",this.REMOVE_KEY_LISTENER="remove-key-listener",this.ADD_BUTTON_LISTENER="add-button-listener",this.REMOVE_BUTTON_LISTENER="remove-button-listener",this.APP_INIT_EVENT="app-init",this.ITEM_MOVED_EVENT="workspace-item-moved",this.ITEM_PRESSED_EVENT="workspace-item-pressed",this.ITEM_DRAG_ENDED_EVENT="workspace-drag-ended",this.ITEM_DELETED_EVENT="workspace-item-deleted",this.ITEM_SELECTION_CHANGED_EVENT="workspace-item-selection-changed",this.isInit=!1,this.isRunning=!1,this._sandbox=t,this._onConnect=()=>{this.isRunning&&this._operateOnSelected(t=>this.beginConnecting(t),g.a)},this._onEdit=()=>{this.isRunning&&this._operateOnSelected(t=>this.beginEditTransition(t),p.a)}}init(){this.isInit||(this._sandbox.registerListener(this.APP_INIT_EVENT,{callback:this.onAppInit,thisArg:this}),this._sandbox.createEvent(this.TRANSITION_CREATED_EVENT),this._sandbox.createEvent(this.TRANSITION_EDITED_EVENT),this._sandbox.createEvent(this.TRANSITION_DELETED_EVENT),this.isInit=!0)}start(){this.isRunning||(this._sandbox.registerListener(this.ITEM_MOVED_EVENT,{callback:this._onItemMoved,thisArg:this}),this._sandbox.registerListener(this.ITEM_PRESSED_EVENT,{callback:this._onItemPressed,thisArg:this}),this._sandbox.registerListener(this.ITEM_DRAG_ENDED_EVENT,{callback:this._onDragEnded,thisArg:this}),this._sandbox.registerListener(this.ITEM_DELETED_EVENT,{callback:this._onItemDeleted,thisArg:this}),this._sandbox.registerListener(this.ITEM_SELECTION_CHANGED_EVENT,{callback:this._onItemSelectionChanged,thisArg:this}),this.isRunning=!0)}onAppInit(){this._sandbox.unregisterListener(this.APP_INIT_EVENT,this.onAppInit),this._sandbox.sendMessage(this.ADD_KEY_LISTENER,{key:"Enter",listener:this._onEdit}),this._sandbox.sendMessage(this.ADD_BUTTON_LISTENER,{id:"connect",listener:this._onConnect}),this._sandbox.sendMessage(this.ADD_BUTTON_LISTENER,{id:"edit",listener:this._onEdit})}beginConnecting(t,e){e=e||t.getPosition();let s=new p.a({text:"$",position:e,first:t});this._sandbox.sendMessage(this.ADD_ITEM,s),this._sandbox.sendMessage(this.BEGIN_DRAG,{item:s,point:e})}endConnecting(t,e){let s=this._sandbox.sendMessage(this.GET_ITEM_AT,{point:e,predicate:function(t){return t instanceof g.a}});s?(t.setEnd(s),this._sandbox.raiseEvent(this.TRANSITION_CREATED_EVENT,t),this._sandbox.sendMessage(this.REFRESH_WORKSPACE)):this._sandbox.sendMessage(this.REMOVE_ITEM,t)}beginEditTransition(t){this._sandbox.sendMessage(this.REMOVE_KEY_LISTENER,{key:"Enter",listener:this._onEdit});let e=()=>{let e=this._sandbox.sendMessage(this.HIDE_POPUP).find(t=>"condition"===t.name).value;this.endEditTransition(t,e)},s=()=>{this._sandbox.sendMessage(this.HIDE_POPUP),this.endEditTransition(t)};this._sandbox.sendMessage(this.SHOW_POPUP,{message:"Please enter a set of unseparated symbols activating the transition.\nUse dollar sign ($) for the empty string.",input:[{name:"condition",label:"Transition condition"}],buttons:[{text:"Save",onClick:e},{text:"Cancel",onClick:s}],onEscape:s,onEnter:e})}endEditTransition(t,e){if(void 0!==e){const s=t.getText();t.setText(this._parseText(e)),this._sandbox.raiseEvent(this.TRANSITION_EDITED_EVENT,{transition:t,changes:[{name:"text",oldValue:s}]}),this._sandbox.sendMessage(this.REFRESH_WORKSPACE)}this._sandbox.sendMessage(this.ADD_KEY_LISTENER,{key:"Enter",listener:this._onEdit})}stop(){this.isRunning&&(this.isRunning=!1,this._sandbox.unregisterListener(this.ITEM_MOVED_EVENT,this._onItemMoved),this._sandbox.unregisterListener(this.ITEM_PRESSED_EVENT,this._onItemPressed),this._sandbox.unregisterListener(this.ITEM_DRAG_ENDED_EVENT,this._onDragEnded),this._sandbox.unregisterListener(this.ITEM_DELETED_EVENT,this._onItemDeleted),this._sandbox.unregisterListener(this.ITEM_SELECTION_CHANGED_EVENT,this._onItemSelectionChanged))}cleanUp(){this._sandbox.deleteEvent(this.TRANSITION_CREATED_EVENT),this._sandbox.deleteEvent(this.TRANSITION_EDITED_EVENT),this._sandbox.deleteEvent(this.TRANSITION_DELETED_EVENT),this._sandbox.sendMessage(this.REMOVE_KEY_LISTENER,{key:"Enter",listener:this._onEdit}),this._sandbox.sendMessage(this.REMOVE_BUTTON_LISTENER,{id:"connect",listener:this._onConnect}),this._sandbox.sendMessage(this.REMOVE_BUTTON_LISTENER,{id:"edit",listener:this._onEdit})}_operateOnSelected(t,e){let s=this._sandbox.sendMessage(this.GET_SELECTED_ITEM);if(s&&(!e||s instanceof e))return t(s)}_parseText(t){return t.split("").filter((function(t,e,s){return s.indexOf(t)===e})).join(", ")}_onItemPressed(t){t.item instanceof g.a&&t.ctrlKey&&this.beginConnecting(t.item,t.point)}_onItemMoved(t){if(t.item instanceof p.a&&!t.item.isSet){let e=this._sandbox.sendMessage(this.GET_ITEM_AT,{point:t.point,predicate:function(t){return t instanceof g.a}});e?t.item.setEndTemporarily(e):t.item.setEndTemporarily(null)}}_onDragEnded(t){t.item instanceof p.a&&(t.item.isSet?T.b.arePointsEqual(t.from,t.to)||this._sandbox.raiseEvent(this.TRANSITION_EDITED_EVENT,{transition:t.item,changes:[{name:"position",oldValue:t.from}]}):this.endConnecting(t.item,t.point))}_onItemDeleted(t){if(t.item instanceof g.a){this._sandbox.sendMessage(this.GET_ITEMS,e=>e instanceof p.a&&(e.firstItem===t.item||e.secondItem===t.item)).forEach(t=>{this._sandbox.sendMessage(this.REMOVE_ITEM,t)})}else t.item instanceof p.a&&t.item.isSet&&this._sandbox.raiseEvent(this.TRANSITION_DELETED_EVENT,t.item)}_onItemSelectionChanged(t){t.newItem instanceof p.a&&(this._sandbox.sendMessage(this.SET_CONTROL_DISABLED,{id:"connect",disabled:!0}),this._sandbox.sendMessage(this.SET_CONTROL_DISABLED,{id:"accept",disabled:!0}),this._sandbox.sendMessage(this.SET_CONTROL_DISABLED,{id:"initial",disabled:!0}),this._sandbox.sendMessage(this.SET_CONTROL_DISABLED,{id:"edit",disabled:!1}),this._sandbox.sendMessage(this.SET_CONTROL_DISABLED,{id:"delete",disabled:!1}))}}var b=s(12);!function(t){const e=new i.a;e.addModule(n.a,"canvas",{isInteractive:!0,minSize:{width:800,height:600}}),e.addModule(a.a,"dom-manager",{entrypoint:"workspace"}),e.addModule(r.a,"interaction"),e.addModule(h.a,"workspace"),e.addModule(l,"item-selector"),e.addModule(d,"item-dragger"),e.addModule(o,"ruler",{distance:15,reach:3,visibility:!0}),e.addModule(b.a,"fsm-loader"),e.addModule(_.a,"fsm-cache-manager",{autosaving:!0}),e.addModule(u,"fsm-state-manager"),e.addModule(I,"fsm-transition-manager"),e.addModule(E.a,"fsm-serializer"),e.addModule(c.a,"popup-manager"),e.init()}()}]);