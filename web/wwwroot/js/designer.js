!function(e){var t={};function s(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(i,n,function(t){return e[t]}.bind(null,n));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";s.r(t);let i={remove:function(e,t){let s=!1;if(t&&t instanceof Array)for(let i=0,n=t.length;i<n;i++)t[i]===e&&(t.splice(i,1),s=!0);return s}},n={forEachOwnProperty:function(e,t){for(let s in e)e.hasOwnProperty(s)&&t(s,e[s])}};class r{constructor(e,t,s){this._name=e,this._methods=t||[],this._properties=s||[];for(let e=0,s=t.length;e<s;e++){if("string"!=typeof t[e])throw new Error("To define an interface you need to provide list of method names of type string");this._methods.push(t[e])}for(let e=0,t=s.length;e<t;e++){if("string"!=typeof s[e])throw new Error("To define an interface you need to provide list of property names of type string");this._properties.push(s[e])}}isImplemtedBy(e){if("object"!=typeof e)throw new Error("The "+this._name+" interface is not implemented by "+typeof e);for(let t=0,s=this._methods.length;t<s;t++){let s=this._methods[t];if(!e[s]||"function"!=typeof e[s])throw new Error("Object does not implement the interface "+this._name)}for(let t=0,s=this._properties.length;t<s;t++){let s=this._properties[t];if(!e[s]||"function"==typeof e[s])throw new Error("Object does not implement the interface "+this._name)}}}class a{constructor(){this._listeners=[]}registerListener(e){if(!e||"function"!=typeof e)throw new Error("Event listener has to be of type function");this._listeners.push(e)}unregisterListener(e){return i.remove(e,this._listeners)}clear(){this._listeners=[]}invoke(e){const t=this._listeners;for(let s=0,i=t.length;s<i;s++)t[s](e)}}class o{constructor(){this.EVENT_REGISTERED_EVENT="event-registered",this.EVENT_UNREGISTERED_EVENT="event-unregistered",this._events=new Map,this._events.set(this.EVENT_REGISTERED_EVENT,new a),this._events.set(this.EVENT_UNREGISTERED_EVENT,new a)}create(e){this._events.has(e)||(this._events.set(e,new a),this.raise(this.EVENT_REGISTERED_EVENT,e))}delete(e){let t=!1,s=this._events;return s.has(e)&&(s.delete(e),this.raise(this.EVENT_UNREGISTERED_EVENT,e),t=!0),t}raise(e,t){let s=!1,i=this._events.get(e);return i&&(i.invoke(t),s=!0),s}registerListener(e,t){let s=!1,i=this._events.get(e);return i&&(i.registerListener(t),s=!0),s}unregisterListener(e,t){let s=!1,i=this._events.get(e);return i&&(s=i.unregisterListener(t)),s}}class h{constructor(){this._receivers=new Map}register(e,t){let s=this._receivers;if(s.has(e))throw new Error("Receiver "+e+" already registered");if(!t||"function"!=typeof t)throw new Error("Receiver must be a function");s.set(e,t)}unregister(e){let t=!1,s=this._receivers;return s.has(e)&&(s.delete(e),t=!0),t}send(e,t){let s=this._receivers;if(!s.has(e))throw new Error("Receiver "+e+" not registered");return s.get(e)(t)}}class _{constructor(){this._modules=new Map}add(e,t){this._modules.set(t,e)}init(e){let t=!1,s=this._modules.get(e);return s&&(s.isInit||s.init(),t=!0),t}initAll(){for(let e of this._modules.values())e.isInit||e.init()}addAndInit(e,t){return this.add(e,t),e.isInit||e.init(),!0}stop(e){let t=!1,s=this._modules.get(e);return s&&(s.isInit&&s.stop(),t=!0),t}remove(e){let t=!1,s=this._modules;return s.has(e)&&(this.stop(e),s.get(e).cleanUp(),s.delete(e),t=!0),t}}class E{constructor(){this._interfaces=new Map}declare(e,t,s){this._interfaces.set(e,new r(e,t,s))}assert(e,t){const s=this._interfaces.get(t);if(!s)throw new Error("Interface "+t+" is not declared");s.isImplemtedBy(e)}}class d{constructor(e){this._core=e}registerMessageReceiver(e,t){this._core.registerMessageReceiver(e,t)}unregisterMessageReceiver(e){return this._core.unregisterMessageReceiver(e)}sendMessage(e,t){return this._core.sendMessage(e,t)}createEvent(e){this._core.createEvent(e)}deleteEvent(e){return this._core.deleteEvent(e)}raiseEvent(e,t){return this._core.raiseEvent(e,t)}registerListener(e,t){this._core.registerListener(e,t)}unregisterListener(e,t){return this._core.unregisterListener(e,t)}declareInterface(e,t,s){this._core.declareInterface(e,t,s)}assertInterface(e,t){this._core.assertInterface(e,t)}}class l{constructor(){this.APP_INIT_EVENT="app-init",this.MODULE_INTERFACE="module",this._isInit=!1,this._sandbox=new d(this),this._mediator=new h,this._modulesManager=new _,this._eventsManager=new o,this._interfacesManager=new E,this.createEvent(this.APP_INIT_EVENT),this.declareInterface(this.MODULE_INTERFACE,["init","stop","cleanUp"],[])}init(){return this._isInit||(this._modulesManager.initAll(),this._isInit=!0,this.raiseEvent(this.APP_INIT_EVENT)),null}addModule(e,t,s){const i=new e(this._sandbox,s);this.assertInterface(i,this.MODULE_INTERFACE),this._modulesManager.add(i,t)}addModuleAndInit(e,t,s){const i=new e(this._sandbox,s);this.assertInterface(i,this.MODULE_INTERFACE),this._modulesManager.addAndInit(i,t)}removeModule(e){return this._modulesManager.remove(e)}initModule(e){return this._modulesManager.init(e)}stopModule(e){return this._modulesManager.stop(e)}registerMessageReceiver(e,t){this._mediator.register(e,t)}unregisterMessageReceiver(e){return this._mediator.unregister(e)}sendMessage(e,t){return this._mediator.send(e,t)}createEvent(e){this._eventsManager.create(e)}deleteEvent(e){return this._eventsManager.delete(e)}raiseEvent(e,t){return this._eventsManager.raise(e,t)}registerListener(e,t){this._eventsManager.registerListener(e,t)}unregisterListener(e,t){return this._eventsManager.unregisterListener(e,t)}declareInterface(e,t,s){this._interfacesManager.declare(e,t,s)}assertInterface(e,t){this._interfacesManager.assert(e,t)}}class c{constructor(e,t){this.CLEAR_CANVAS="canvas-clear",this.DRAW_ON_CANVAS="canvas-draw",this.REDRAW_CANVAS="canvas-redraw",this.CANVAS_CLEARED_EVENT="canvas-cleared",this.CANVAS_DRAWN_EVENT="canvas-drawn",this.CANVAS_REDRAWN_EVENT="canvas-redrawn",this.APPEND_DOM_ELEMENT="append-dom-element",this.MAKE_INTERACTIVE="make-interactive",this.APP_INIT_EVENT="app-init",this._isInit=!1,this._isInteractive=!(!t||void 0===t.isInteractive)&&t.isInteractive,this._sandbox=e,this._canvas,this._context,this._sandbox.registerMessageReceiver(this.CLEAR_CANVAS,this.clear.bind(this)),this._sandbox.registerMessageReceiver(this.DRAW_ON_CANVAS,this.draw.bind(this)),this._sandbox.registerMessageReceiver(this.REDRAW_CANVAS,this.redraw.bind(this)),this._sandbox.createEvent(this.CANVAS_CLEARED_EVENT),this._sandbox.createEvent(this.CANVAS_DRAWN_EVENT),this._sandbox.createEvent(this.CANVAS_REDRAWN_EVENT)}init(){this._isInit||(this._sandbox.registerListener(this.APP_INIT_EVENT,this.onAppInit.bind(this)),this._isInit=!0)}onAppInit(){this._canvas=this._sandbox.sendMessage(this.APPEND_DOM_ELEMENT,{type:"canvas",width:"800px",height:"600px"}),this._context=this._canvas.getContext("2d",{alpha:!1}),this._isInteractive&&this._sandbox.sendMessage(this.MAKE_INTERACTIVE,this._canvas),this.clear()}clear(){this._context.save(),this._context.fillStyle="#FFFFFF",this._context.fillRect(0,0,this._canvas.width,this._canvas.height),this._context.restore()}draw(e){if(e instanceof Array)for(let t=0,s=e.length;t<s;t++)e[t].draw(this._context);else e.draw(this._context)}redraw(e){this.clear(),this.draw(e)}stop(){}cleanUp(){this._sandbox.unregisterMessageReceiver(this.CLEAR_CANVAS),this._sandbox.unregisterMessageReceiver(this.DRAW_ON_CANVAS),this._sandbox.unregisterMessageReceiver(this.REDRAW_CANVAS),this._sandbox.deleteEvent(this.CANVAS_CLEARED_EVENT),this._sandbox.deleteEvent(this.CANVAS_DRAWN_EVENT),this._sandbox.deleteEvent(this.CANVAS_REDRAWN_EVENT)}}class u{constructor(e,t){if(this.APPEND_DOM_ELEMENT="append-dom-element",this.APP_INIT_EVENT="app-init",!t||!t.entrypoint)throw new Error("DomManager requires configuration object with an entrypoint defined");this._isInit=!1,this._sandbox=e,this._outerDiv=document.getElementById(t.entrypoint),this._sandbox.registerMessageReceiver(this.APPEND_DOM_ELEMENT,this.appendDomElement.bind(this))}init(){this._isInit||(this._sandbox.registerListener(this.APP_INIT_EVENT,this.onAppInit.bind(this)),this._isInit=!0)}onAppInit(){}appendDomElement(e){if(!e||!e.type)throw new Error("You need to provide configuration for the DOM element to append");let t=document.createElement(e.type);return e.type=null,e.style&&(n.forEachOwnProperty(e.style,(e,s)=>{t.style[e]=s}),e.style=null),e.rawContent?e.rawContent=null:e.domContent&&(e.domContent=null),n.forEachOwnProperty(e,(e,s)=>{null!==t.hasAttribute(e)&&null!==s&&t.setAttribute(e,s)}),this._outerDiv.appendChild(t),t}stop(){}cleanUp(){}}class p{constructor(e){this.MAKE_INTERACTIVE="make-interactive",this.DOUBLE_CLICK_EVENT="double-click",this.POINTER_DOWN_EVENT="pointer-down",this.POINTER_MOVE_EVENT="pointer-move",this.POINTER_UP_EVENT="pointer-up",this.APP_INIT_EVENT="app-init",this._isInit=!1,this._sandbox=e,this._sandbox.registerMessageReceiver(this.MAKE_INTERACTIVE,this.makeInteractive.bind(this)),this._sandbox.createEvent(this.DOUBLE_CLICK_EVENT),this._sandbox.createEvent(this.POINTER_DOWN_EVENT),this._sandbox.createEvent(this.POINTER_MOVE_EVENT),this._sandbox.createEvent(this.POINTER_UP_EVENT)}init(){this._isInit||(this._sandbox.registerListener(this.APP_INIT_EVENT,this.onAppInit.bind(this)),this._isInit=!0)}onAppInit(){}makeInteractive(e){e.addEventListener("selectstart",(function(e){return e.preventDefault(),!1}),!1),e.addEventListener("dblclick",this._handleDoubleClick.bind(this)),e.addEventListener("mousedown",this._handleMouseDown.bind(this)),e.addEventListener("mousemove",this._handleMouseMove.bind(this)),e.addEventListener("mouseup",this._handleMouseUp.bind(this))}stop(){}cleanUp(){this._sandbox.deleteEvent(this.DOUBLE_CLICK_EVENT),this._sandbox.deleteEvent(this.POINTER_DOWN_EVENT),this._sandbox.deleteEvent(this.POINTER_MOVE_EVENT),this._sandbox.deleteEvent(this.POINTER_UP_EVENT)}_getPointInElement(e,t,s){var i=e.getBoundingClientRect();return{x:t-i.left,y:s-i.top}}_handleDoubleClick(e){var t=this._getPointInElement(e.target,e.clientX,e.clientY);this._sandbox.raiseEvent(this.DOUBLE_CLICK_EVENT,{target:e.target,x:t.x,y:t.y})}_handleMouseDown(e){var t=this._getPointInElement(e.target,e.clientX,e.clientY);this._sandbox.raiseEvent(this.POINTER_DOWN_EVENT,{target:e.target,x:t.x,y:t.y})}_handleMouseMove(e){var t=this._getPointInElement(e.target,e.clientX,e.clientY);this._sandbox.raiseEvent(this.POINTER_MOVE_EVENT,{target:e.target,x:t.x,y:t.y})}_handleMouseUp(e){var t=this._getPointInElement(e.target,e.clientX,e.clientY);this._sandbox.raiseEvent(this.POINTER_UP_EVENT,{target:e.target,x:t.x,y:t.y})}}class N{constructor(e,t,s){this._radius=void 0===s?50:e,this._posX=void 0===e?0:e,this._posY=void 0===t?0:t}contains(e,t){return e>=this._posX-this._radius&&e<=this._posX+this._radius&&t>=this._posY-this._radius&&t<=this._posY+this._radius}draw(e){e.beginPath(),e.arc(this._posX,this._posY,this._radius,0,2*Math.PI),e.stroke()}setCoords(e,t){this._posX=e,this._posY=t}}class v{constructor(e){this.WORKSPACE_ELEMENT_INTERFACE="workspace-element",this.APP_INIT_EVENT="app-init",this.CLEAR_CANVAS="canvas-clear",this.DRAW_ON_CANVAS="canvas-draw",this.REDRAW_CANVAS="canvas-redraw",this.DOUBLE_CLICK_EVENT="double-click",this.POINTER_DOWN_EVENT="pointer-down",this.POINTER_MOVE_EVENT="pointer-move",this.POINTER_UP_EVENT="pointer-up",this._isInit=!1,this._sandbox=e,this._elements=[],this._selectedElement=null,this._sandbox.declareInterface(this.WORKSPACE_ELEMENT_INTERFACE,["contains","draw","setCoords"],[])}init(){this._isInit||(this._sandbox.registerListener(this.APP_INIT_EVENT,this.onAppInit.bind(this)),this._sandbox.registerListener(this.DOUBLE_CLICK_EVENT,this._handleDoubleClick.bind(this)),this._sandbox.registerListener(this.POINTER_DOWN_EVENT,this._handlePointerDown.bind(this)),this._sandbox.registerListener(this.POINTER_MOVE_EVENT,this._handlePointerMove.bind(this)),this._sandbox.registerListener(this.POINTER_UP_EVENT,this._handlePointerUp.bind(this)),this._isInit=!0)}onAppInit(){}add(e){this._sandbox.assertInterface(e,this.WORKSPACE_ELEMENT_INTERFACE),this._elements.push(e),this._sandbox.sendMessage(this.DRAW_ON_CANVAS,e)}stop(){}cleanUp(){}_handleDoubleClick(e){this.add(new N(e.x,e.y))}_handlePointerDown(e){let t=this._elements;for(let s=t.length-1;s>=0;s--){let i=t[s];if(t[s].contains(e.x,e.y)){this._selectedElement=i;break}}}_handlePointerMove(e){this._selectedElement&&(this._selectedElement.setCoords(e.x,e.y),this._sandbox.sendMessage(this.REDRAW_CANVAS,this._elements))}_handlePointerUp(e){this._selectedElement&&(this._selectedElement=null)}}!function(e){const t=new l;t.addModule(c,"canvas",{isInteractive:!0}),t.addModule(u,"dom-manager",{entrypoint:"workspace"}),t.addModule(p,"interaction"),t.addModule(v,"workspace"),t.init()}()}]);