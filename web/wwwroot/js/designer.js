!function(e){var t={};function s(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(i,n,function(t){return e[t]}.bind(null,n));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";s.r(t);let i={remove:function(e,t){let s=!1;if(t&&t instanceof Array)for(let i=0,n=t.length;i<n;i++)t[i]===e&&(t.splice(i,1),s=!0);return s}},n={forEachOwnProperty:function(e,t){for(let s in e)e.hasOwnProperty(s)&&t(s,e[s])}};class r{constructor(e,t,s){this._name=e,this._methods=t||[],this._properties=s||[];for(let e=0,s=t.length;e<s;e++){if("string"!=typeof t[e])throw new Error("To define an interface you need to provide list of method names of type string");this._methods.push(t[e])}for(let e=0,t=s.length;e<t;e++){if("string"!=typeof s[e])throw new Error("To define an interface you need to provide list of property names of type string");this._properties.push(s[e])}}isImplemtedBy(e){if("object"!=typeof e)throw new Error("The "+this._name+" interface is not implemented by "+typeof e);for(let t=0,s=this._methods.length;t<s;t++){let s=this._methods[t];if(!e[s]||"function"!=typeof e[s])throw new Error("Object does not implement the interface "+this._name)}for(let t=0,s=this._properties.length;t<s;t++){let s=this._properties[t];if(!e[s]||"function"==typeof e[s])throw new Error("Object does not implement the interface "+this._name)}}}class h{constructor(){this._listeners=[]}registerListener(e){if(!e||"function"!=typeof e)throw new Error("Event listener has to be of type function");this._listeners.push(e)}unregisterListener(e){return i.remove(e,this._listeners)}clear(){this._listeners=[]}invoke(e){const t=this._listeners;for(let s=0,i=t.length;s<i;s++)t[s](e)}}class a{constructor(){this.EVENT_REGISTERED_EVENT="event-registered",this.EVENT_UNREGISTERED_EVENT="event-unregistered",this._events=new Map,this._events.set(this.EVENT_REGISTERED_EVENT,new h),this._events.set(this.EVENT_UNREGISTERED_EVENT,new h)}create(e){this._events.has(e)||(this._events.set(e,new h),this.raise(this.EVENT_REGISTERED_EVENT,e))}delete(e){let t=!1,s=this._events;return s.has(e)&&(s.delete(e),this.raise(this.EVENT_UNREGISTERED_EVENT,e),t=!0),t}raise(e,t){let s=!1,i=this._events.get(e);return i&&(i.invoke(t),s=!0),s}registerListener(e,t){let s=!1,i=this._events.get(e);return i&&(i.registerListener(t),s=!0),s}unregisterListener(e,t){let s=!1,i=this._events.get(e);return i&&(s=i.unregisterListener(t)),s}}class o{constructor(){this._receivers=new Map}register(e,t){let s=this._receivers;if(s.has(e))throw new Error("Receiver "+e+" already registered");if(!t||"function"!=typeof t)throw new Error("Receiver must be a function");s.set(e,t)}unregister(e){let t=!1,s=this._receivers;return s.has(e)&&(s.delete(e),t=!0),t}send(e,t){let s=this._receivers;if(!s.has(e))throw new Error("Receiver "+e+" not registered");return s.get(e)(t)}}class _{constructor(){this._modules=new Map}add(e,t){this._modules.set(t,e)}init(e){let t=!1,s=this._modules.get(e);return s&&(s.isInit||s.init(),t=!0),t}initAll(){for(let e of this._modules.values())e.isInit||e.init()}addAndInit(e,t){return this.add(e,t),e.isInit||e.init(),!0}stop(e){let t=!1,s=this._modules.get(e);return s&&(s.isInit&&s.stop(),t=!0),t}remove(e){let t=!1,s=this._modules;return s.has(e)&&(this.stop(e),s.get(e).cleanUp(),s.delete(e),t=!0),t}}class E{constructor(){this._interfaces=new Map}declare(e,t,s){this._interfaces.set(e,new r(e,t,s))}assert(e,t){const s=this._interfaces.get(t);if(!s)throw new Error("Interface "+t+" is not declared");s.isImplemtedBy(e)}}class d{constructor(e){this._core=e}registerMessageReceiver(e,t){this._core.registerMessageReceiver(e,t)}unregisterMessageReceiver(e){return this._core.unregisterMessageReceiver(e)}sendMessage(e,t){return this._core.sendMessage(e,t)}createEvent(e){this._core.createEvent(e)}deleteEvent(e){return this._core.deleteEvent(e)}raiseEvent(e,t){return this._core.raiseEvent(e,t)}registerListener(e,t){this._core.registerListener(e,t)}unregisterListener(e,t){return this._core.unregisterListener(e,t)}declareInterface(e,t,s){this._core.declareInterface(e,t,s)}assertInterface(e,t){this._core.assertInterface(e,t)}}class l{constructor(){this.APP_INIT_EVENT="app-init",this.MODULE_INTERFACE="module",this._isInit=!1,this._sandbox=new d(this),this._mediator=new o,this._modulesManager=new _,this._eventsManager=new a,this._interfacesManager=new E,this.createEvent(this.APP_INIT_EVENT),this.declareInterface(this.MODULE_INTERFACE,["init","stop","cleanUp"],[])}init(){return this._isInit||(this._modulesManager.initAll(),this._isInit=!0,this.raiseEvent(this.APP_INIT_EVENT)),null}addModule(e,t,s){const i=new e(this._sandbox,s);this.assertInterface(i,this.MODULE_INTERFACE),this._modulesManager.add(i,t)}addModuleAndInit(e,t,s){const i=new e(this._sandbox,s);this.assertInterface(i,this.MODULE_INTERFACE),this._modulesManager.addAndInit(i,t)}removeModule(e){return this._modulesManager.remove(e)}initModule(e){return this._modulesManager.init(e)}stopModule(e){return this._modulesManager.stop(e)}registerMessageReceiver(e,t){this._mediator.register(e,t)}unregisterMessageReceiver(e){return this._mediator.unregister(e)}sendMessage(e,t){return this._mediator.send(e,t)}createEvent(e){this._eventsManager.create(e)}deleteEvent(e){return this._eventsManager.delete(e)}raiseEvent(e,t){return this._eventsManager.raise(e,t)}registerListener(e,t){this._eventsManager.registerListener(e,t)}unregisterListener(e,t){return this._eventsManager.unregisterListener(e,t)}declareInterface(e,t,s){this._interfacesManager.declare(e,t,s)}assertInterface(e,t){this._interfacesManager.assert(e,t)}}class c{constructor(e,t){this.CLEAR_CANVAS="canvas-clear",this.DRAW_ON_CANVAS="canvas-draw",this.REDRAW_CANVAS="canvas-redraw",this.CANVAS_CLEARED_EVENT="canvas-cleared",this.CANVAS_DRAWN_EVENT="canvas-drawn",this.APPEND_DOM_ELEMENT="append-dom-element",this.MAKE_INTERACTIVE="make-interactive",this.APP_INIT_EVENT="app-init",this._isInit=!1,this._isInteractive=!(!t||void 0===t.isInteractive)&&t.isInteractive,this._sandbox=e,this._canvas,this._context,this._sandbox.registerMessageReceiver(this.CLEAR_CANVAS,this.clear.bind(this)),this._sandbox.registerMessageReceiver(this.DRAW_ON_CANVAS,this.draw.bind(this)),this._sandbox.registerMessageReceiver(this.REDRAW_CANVAS,this.redraw.bind(this)),this._sandbox.createEvent(this.CANVAS_CLEARED_EVENT),this._sandbox.createEvent(this.CANVAS_DRAWN_EVENT)}init(){this._isInit||(this._sandbox.registerListener(this.APP_INIT_EVENT,this.onAppInit.bind(this)),this._isInit=!0)}onAppInit(){this._canvas=this._sandbox.sendMessage(this.APPEND_DOM_ELEMENT,{type:"canvas",width:"800px",height:"600px",style:{"border-style":"solid","border-width":"1px"}}),this._context=this._canvas.getContext("2d",{alpha:!1}),this._isInteractive&&this._sandbox.sendMessage(this.MAKE_INTERACTIVE,this._canvas),this.clear()}clear(){this._context.save(),this._context.fillStyle="#FFFFFF",this._context.fillRect(0,0,this._canvas.width,this._canvas.height),this._context.restore(),this._sandbox.raiseEvent(this.CANVAS_CLEARED_EVENT,this._canvas)}draw(e){if(e instanceof Array)for(let t=0,s=e.length;t<s;t++)e[t].draw(this._context);else e.draw(this._context);this._sandbox.raiseEvent(this.CANVAS_DRAWN_EVENT,{canvas:this._canvas,drawables:e})}redraw(e){this.clear(),this.draw(e)}stop(){this._isInit=!1}cleanUp(){this._sandbox.unregisterMessageReceiver(this.CLEAR_CANVAS),this._sandbox.unregisterMessageReceiver(this.DRAW_ON_CANVAS),this._sandbox.unregisterMessageReceiver(this.REDRAW_CANVAS),this._sandbox.deleteEvent(this.CANVAS_CLEARED_EVENT),this._sandbox.deleteEvent(this.CANVAS_DRAWN_EVENT),this._sandbox.deleteEvent(this.CANVAS_REDRAWN_EVENT)}}class u{constructor(e,t){if(this.APPEND_DOM_ELEMENT="append-dom-element",this.APP_INIT_EVENT="app-init",!t||!t.entrypoint)throw new Error("DomManager requires configuration object with an entrypoint defined");this._isInit=!1,this._sandbox=e,this._outerDiv=document.getElementById(t.entrypoint),this._sandbox.registerMessageReceiver(this.APPEND_DOM_ELEMENT,this.appendDomElement.bind(this))}init(){this._isInit||(this._sandbox.registerListener(this.APP_INIT_EVENT,this.onAppInit.bind(this)),this._isInit=!0)}onAppInit(){}appendDomElement(e){if(!e||!e.type)throw new Error("You need to provide configuration for the DOM element to append");let t=document.createElement(e.type);return e.type=null,e.style&&(n.forEachOwnProperty(e.style,(e,s)=>{t.style[e]=s}),e.style=null),e.rawContent?e.rawContent=null:e.domContent&&(e.domContent=null),n.forEachOwnProperty(e,(e,s)=>{null!==t.hasAttribute(e)&&null!==s&&t.setAttribute(e,s)}),this._outerDiv.appendChild(t),t}stop(){this._isInit=!1}cleanUp(){}}class I{constructor(e){this.MAKE_INTERACTIVE="make-interactive",this.DOUBLE_CLICK_EVENT="double-click",this.POINTER_DOWN_EVENT="pointer-down",this.POINTER_MOVE_EVENT="pointer-move",this.POINTER_UP_EVENT="pointer-up",this.APP_INIT_EVENT="app-init",this._isInit=!1,this._sandbox=e,this._sandbox.registerMessageReceiver(this.MAKE_INTERACTIVE,this.makeInteractive.bind(this)),this._sandbox.createEvent(this.DOUBLE_CLICK_EVENT),this._sandbox.createEvent(this.POINTER_DOWN_EVENT),this._sandbox.createEvent(this.POINTER_MOVE_EVENT),this._sandbox.createEvent(this.POINTER_UP_EVENT)}init(){this._isInit||(this._sandbox.registerListener(this.APP_INIT_EVENT,this.onAppInit.bind(this)),this._isInit=!0)}onAppInit(){}makeInteractive(e){e.addEventListener("selectstart",(function(e){return e.preventDefault(),!1}),!1),e.addEventListener("dblclick",this._handleDoubleClick.bind(this)),e.addEventListener("mousedown",this._handleMouseDown.bind(this)),e.addEventListener("mousemove",this._handleMouseMove.bind(this)),e.addEventListener("mouseup",this._handleMouseUp.bind(this))}stop(){this._isInit=!1}cleanUp(){this._sandbox.deleteEvent(this.DOUBLE_CLICK_EVENT),this._sandbox.deleteEvent(this.POINTER_DOWN_EVENT),this._sandbox.deleteEvent(this.POINTER_MOVE_EVENT),this._sandbox.deleteEvent(this.POINTER_UP_EVENT)}_getPointInElement(e,t,s){var i=e.getBoundingClientRect();return{x:t-i.left,y:s-i.top}}_handleDoubleClick(e){var t=this._getPointInElement(e.target,e.clientX,e.clientY);this._sandbox.raiseEvent(this.DOUBLE_CLICK_EVENT,{target:e.target,x:t.x,y:t.y})}_handleMouseDown(e){var t=this._getPointInElement(e.target,e.clientX,e.clientY);this._sandbox.raiseEvent(this.POINTER_DOWN_EVENT,{target:e.target,x:t.x,y:t.y})}_handleMouseMove(e){var t=this._getPointInElement(e.target,e.clientX,e.clientY);this._sandbox.raiseEvent(this.POINTER_MOVE_EVENT,{target:e.target,x:t.x,y:t.y})}_handleMouseUp(e){var t=this._getPointInElement(e.target,e.clientX,e.clientY);this._sandbox.raiseEvent(this.POINTER_UP_EVENT,{target:e.target,x:t.x,y:t.y})}}class p{constructor(e){this.SELECT_ITEM="select-item",this.ITEM_DRAGGED_EVENT="item-dragged",this.ITEM_POINTER_OVER_CHANGED_EVENT="item-pointer-over-changed",this.ITEM_SELECTION_CHANGED_EVENT="item-selection-changed",this.CLEAR_CANVAS="canvas-clear",this.DRAW_ON_CANVAS="canvas-draw",this.GET_ITEM_AT_POINT="get-item-at-point",this.APP_INIT_EVENT="app-init",this.POINTER_DOWN_EVENT="pointer-down",this.POINTER_MOVE_EVENT="pointer-move",this.POINTER_UP_EVENT="pointer-up",this._isInit=!1,this._sandbox=e,this._draggedItem=null,this._itemPointerOver=null,this._selectedItem=null,this._sandbox.registerMessageReceiver(this.SELECT_ITEM,this.selectItem.bind(this)),this._sandbox.createEvent(this.ITEM_DRAGGED_EVENT),this._sandbox.createEvent(this.ITEM_POINTER_OVER_CHANGED_EVENT),this._sandbox.createEvent(this.ITEM_SELECTION_CHANGED_EVENT)}init(){this._isInit||(this._sandbox.registerListener(this.APP_INIT_EVENT,this.onAppInit.bind(this)),this._sandbox.registerListener(this.POINTER_DOWN_EVENT,this._handlePointerDown.bind(this)),this._sandbox.registerListener(this.POINTER_MOVE_EVENT,this._handlePointerMove.bind(this)),this._sandbox.registerListener(this.POINTER_UP_EVENT,this._handlePointerUp.bind(this)),this._isInit=!0)}onAppInit(){}selectItem(e,t=null){let s={point:t,oldItem:this._selectedItem,newItem:e};this._selectedItem=e,this._sandbox.raiseEvent(this.ITEM_SELECTION_CHANGED_EVENT,s)}stop(){this._isInit=!1}cleanUp(){this._sandbox.unregisterMessageReceiver(this.SELECT_ITEM)}_handlePointerDown(e){let t={x:e.x,y:e.y},s=this._sandbox.sendMessage(this.GET_ITEM_AT_POINT,t);this._draggedItem=s,this.selectItem(s,t)}_handlePointerMove(e){let t={x:e.x,y:e.y};if(this._draggedItem){let e={point:t,item:this._draggedItem};this._sandbox.raiseEvent(this.ITEM_DRAGGED_EVENT,e)}else{let e=this._sandbox.sendMessage(this.GET_ITEM_AT_POINT,t);if(this._itemPointerOver||e){let s={point:t,oldItem:this._itemPointerOver,newItem:e};this._itemPointerOver=e,this._sandbox.raiseEvent(this.ITEM_POINTER_OVER_CHANGED_EVENT,s)}}}_handlePointerUp(e){this._draggedItem=null}}class T{constructor(e,t){this._posX=void 0===e?0:e,this._posY=void 0===t?0:t,this._state="default",this._pointerOffset=null}contains(e,t){return!1}draw(e){}move(e,t){this._pointerOffset&&(e-=this._pointerOffset.x,t-=this._pointerOffset.y),this._posX=e,this._posY=t}select(e){this._state="selected",e&&(this._pointerOffset={x:e.x-this._posX,y:e.y-this._posY})}unselect(){this._state="default",this._pointerAnchor=null}pointerOver(){"selected"!==this._state&&(this._state="hovered")}pointerOut(){"selected"!==this._state&&(this._state="default")}}class N extends T{constructor(e,t,s,i){super(t,s),this._radius=void 0===i?50:t,this._ruler=e}contains(e,t){return e>=this._posX-this._radius&&e<=this._posX+this._radius&&t>=this._posY-this._radius&&t<=this._posY+this._radius}draw(e){switch(e.save(),this._state){case"default":e.strokeStyle="#000000";break;case"hovered":e.strokeStyle="#3BA7FF";break;case"selected":e.strokeStyle="#336699";break;default:throw new Error("There is no "+this._state+" state defined.")}e.beginPath(),e.arc(this._posX,this._posY,this._radius,0,2*Math.PI),e.fillStyle="#FFFFFF",e.fill(),e.stroke(),e.restore()}move(e,t){if(super.move(e,t),this._ruler){let e={left:this._radius,top:this._radius,right:this._radius,bottom:this._radius},t=this._ruler.pull(e,this._posX,this._posY);this._posX=t.x,this._posY=t.y}}}class g{constructor(e,t,s){this._distance=void 0===t?50:t,this._reach=void 0===s?5:s,this.isVisible=e}draw(e){let t=e.canvas,s={name:"height",value:t.height},i={name:"width",value:t.width};if(t.width<t.height){let e=s;s=i,i=e}e.save(),e.strokeStyle="#F0F0F0",e.beginPath();let n=this._distance;for(;n<s.value;n+=this._distance)e.moveTo(0,n),e.lineTo(t.width,n),e.moveTo(n,0),e.lineTo(n,t.height);for(;n<i.value;n+=this._distance)(i.name="width")?(e.moveTo(n,0),e.lineTo(n,t.height)):(e.moveTo(0,n),e.lineTo(t.width,n));e.stroke(),e.restore()}pull(e,t,s){return{x:this._computePosition(t,e.left,e.right),y:this._computePosition(s,e.bottom,e.top)}}_computePosition(e,t,s){let i=this._nearestRuler(e,t,s);return i.distance<=this._reach?i.position:e}_nearestRuler(e,t,s){let i=(e-t)%this._distance,n=this._distance-(e+s)%this._distance,r={};return i<=n?(r.distance=i,r.position=e-i):(r.distance=n,r.position=e+n),r}}class v{constructor(e,t){this.DESIGNER_ELEMENT_INTERFACE="workspace-element",this.GET_ITEM_AT_POINT="get-item-at-point",this.DRAW_ON_CANVAS="canvas-draw",this.REDRAW_CANVAS="canvas-redraw",this.SELECT_ITEM="select-item",this.APP_INIT_EVENT="app-init",this.DOUBLE_CLICK_EVENT="double-click",this.ITEM_DRAGGED_EVENT="item-dragged",this.ITEM_POINTER_OVER_CHANGED_EVENT="item-pointer-over-changed",this.ITEM_SELECTION_CHANGED_EVENT="item-selection-changed",this._isInit=!1,this._sandbox=e,this._passiveItems=[],this._items=[],this._ruler=null,t&&t.useRulers&&(this._ruler=new g(t.rulersVisible,t.rulerSpacing,t.rulerReach)),this._sandbox.declareInterface(this.DESIGNER_ELEMENT_INTERFACE,["contains","draw","move","select","unselect","pointerOver","pointerOut"],[]),this._sandbox.registerMessageReceiver(this.GET_ITEM_AT_POINT,this.getItemAtPoint.bind(this))}init(){this._isInit||(this._sandbox.registerListener(this.APP_INIT_EVENT,this.onAppInit.bind(this)),this._sandbox.registerListener(this.DOUBLE_CLICK_EVENT,this._handleDoubleClick.bind(this)),this._sandbox.registerListener(this.ITEM_DRAGGED_EVENT,this._handleItemDragged.bind(this)),this._sandbox.registerListener(this.ITEM_POINTER_OVER_CHANGED_EVENT,this._handlePointerOverChanged.bind(this)),this._sandbox.registerListener(this.ITEM_SELECTION_CHANGED_EVENT,this._handleSelectionChanged.bind(this)),this._isInit=!0)}onAppInit(){this._ruler&&this._ruler.isVisible&&this._passiveItems.push(this._ruler),this._callRedraw()}addItem(e){this._sandbox.assertInterface(e,this.DESIGNER_ELEMENT_INTERFACE),this._items.push(e),this._sandbox.sendMessage(this.DRAW_ON_CANVAS,e)}getItemAtPoint(e){let t=this._items;for(let s=t.length-1;s>=0;s--){let i=t[s];if(i.contains(e.x,e.y))return i}return null}stop(){this._isInit=!1}cleanUp(){}_handleDoubleClick(e){if(this.getItemAtPoint({x:e.x,y:e.y}));else{let t=new N(this._ruler,e.x,e.y);this._sandbox.sendMessage(this.SELECT_ITEM,t),this.addItem(t)}}_handleItemDragged(e){e.item.move(e.point.x,e.point.y),this._callRedraw()}_handlePointerOverChanged(e){let t=!1;e.oldItem&&(e.oldItem.pointerOut(),t=!0),e.newItem&&(e.newItem.pointerOver(),t=!0),t&&this._callRedraw()}_handleSelectionChanged(e){let t=!1;e.oldItem&&(e.oldItem.unselect(),t=!0),e.newItem&&(e.newItem.select(e.point),t=!0),t&&this._callRedraw()}_callRedraw(){this._sandbox.sendMessage(this.REDRAW_CANVAS,this._passiveItems.concat(this._items))}}!function(e){const t=new l;t.addModule(c,"canvas",{isInteractive:!0}),t.addModule(v,"designer-state",{useRulers:!0,rulersVisible:!0,rulerSpacing:25,rulerReach:3}),t.addModule(u,"dom-manager",{entrypoint:"workspace"}),t.addModule(I,"interaction"),t.addModule(p,"workspace"),t.init()}()}]);